async function Ss(e,t,n){const s=document.querySelector(n),i=`
        <button tabItemId="#split-app, #${e}_tabitem" 
                tabGroup="main_group" 
                data-click="#tabs" 
                onclick="mainTabs(this, '#${e}')" 
                class="xtabs-tab">
            <div class="icon-letters">${t.slice(0,2)}</div>
            <span>${t}</span>
        </button>`,o=document.createElement("div");o.innerHTML=i;const a=o.firstElementChild;s.append(a)}async function ws(e){const t=document.querySelector("#split-left"),n=`
        <div id="${e}_tabitem" class="xtabs-item other">
            <div data-parent-selector="gradio-app" data-selector="#${e} > div" class="portal"></div>
        </div>`,s=document.createElement("div");s.innerHTML=n;const i=s.firstElementChild;t.append(i)}async function Es(){let e=["tab_txt2img","tab_img2img","tab_extras","tab_pnginfo","tab_train","tab_modelmerger","tab_settings","tab_extensions","tab_space","tab_deforum_interface","tab_infinite-image-browsing","tab_anapnoe_sd_uiux_core","tab_anapnoe_sd_uiux_db","tab_anapnoe_sd_uiux_civitai","tab_anapnoe_dock"];const t=document.querySelectorAll("#tabs > .tabitem");for(const n of t){const s=n.id,i=s.split("tab_")[1];!e.includes(s)&&!s.startsWith("tab_ui_theme")&&await Promise.all([Ss(s,i,"#other_extensions"),ws(s)])}}function xs(e,t){const n=document.querySelector(e);if(n){const s=i=>{t.forEach(o=>{const a=document.querySelector(`link[rel="stylesheet"][href*="${o}"]`);if(a){const l=a.cloneNode();i.appendChild(l)}})};n.contentDocument.readyState==="complete"?s(n.contentDocument.head):n.addEventListener("load",i=>{s(i.target.contentDocument.head)},{once:!0})}}function ln(e,t,n){for(const s of e)if(!t.querySelector(`link[rel="stylesheet"][href*="${kn}${s}"]`)){const o=document.createElement("link");o.rel="stylesheet",o.href=`${kn}${s}`,o.onload=()=>{console.log(`Stylesheet ${s} loaded successfully.`)},o.onerror=()=>{console.error(`Error loading stylesheet ${s}.`)},n?t.insertBefore(o,n.nextSibling):t.appendChild(o)}}function Ts(e){const t=document.body,n=t.querySelector('link[rel="stylesheet"][href*="sd-webui-ux"]');n?ln(e,t,n):(ln(e,t),console.warn("The sd-webui-ux/style.css is not found in the body."))}function Ls(e,t,n){const i=Array.from(n.querySelectorAll(`link[rel="stylesheet"][href*="${e}"]`)).find(o=>o.href.includes("sd-webui-ux")&&o.href.includes(e));i?(ln([t],n,i),i.parentNode.removeChild(i),console.log(`Removed existing stylesheet: ${e}`)):console.warn(`No existing stylesheet found: ${e}`)}const zt=window.basePath.includes("builtin"),mn="anapnoe/stable-diffusion-webui-ux",Cs="AUTOMATIC1111/stable-diffusion-webui",As="#anapnoe_app",Yn="1.0.0",Zn=window.basePath,Ft=`${Zn}assets/`,kn=`${Ft}css/`,Kn=`${Ft}templates/`,Is=`${Kn}uiux-gradio-3/`,Ps=`${Kn}forge-gradio-4/`,Jn={"template-deforum-params.html":"deforum","template-deforum-results.html":"deforum"},Ns=["uiux-icons.css","uiux-theme-editor.css","uiux-deforum.css","uiux-iibrowser.css","uiux-physton.css","uiux-virtual.css","uiux-tree.css"];let Gt=null;const at=()=>(Gt||(Gt=document.querySelector(As)),Gt);let Vt=null;const Qn=()=>(Vt||(Vt=document.getElementById("tab_anapnoe_sd_uiux_core")),Vt);let Xt=null;const Ye=()=>(Xt||(Xt=document.querySelector("gradio-app")),Xt);let Yt=null;const es=()=>(Yt||(Yt=document.getElementById("loggerUiUx")),Yt),Ve={};let Lt=null;const ks=()=>{if(!Lt){const e=Ye().querySelector(".versions");if(!e){console.error("Versions element not found");return}Lt=e.innerHTML.replace(Cs,mn).replace(/\n/g,"").split("• "),Lt.forEach(i=>{const[o,a]=i.split(":").map(l=>l.trim());o&&a&&(Ve[o]=a)});const n=Ve.version.split(".")[0].includes("f")?"forge":"AUTOMATIC1111",s=parseInt(Ve.gradio,10);Ve.variant=n,Ve.gradio_major=s}return Lt};let Ct=null;const ts=()=>(Ct||(Ct=Is,Ve.gradio_major>3&&Ve.variant==="forge"&&(Ct=Ps)),Ct),pn=[{value:"SD1",textContent:"SD1"},{value:"SD2",textContent:"SD2"},{value:"SD3",textContent:"SD3"},{value:"SDXL",textContent:"SDXL"},{value:"PONY",textContent:"PONY"},{value:"FLUX",textContent:"FLUX"},{value:"Unknown",textContent:"Unknown"}];let gt;async function Os(){(function(n){console.oldLog=console.log,console.oldWarn=console.warn,gt=function(s,i){return function(...o){const l=o.slice(0,10);let r="",u,d;for(r+=`
                <div class="log-row"><span class="log-date">${new Date().toLocaleString().replace(",","")}</span>`,d=0;d<l.length;d++){u=l[d];const m=u.toString().toLowerCase();let g="";m.indexOf("remove")!==-1||m.indexOf("error")!==-1?g+=" log-remove":m.indexOf("loading")!==-1||m.indexOf("| ref")!==-1||m.indexOf("initial")!==-1||m.indexOf("optimiz")!==-1||m.indexOf("python")!==-1||m.indexOf("success")!==-1?g+=" log-load":m.indexOf("[")!==-1&&(g+=" log-object"),u.toString().indexOf(".css")!==-1||u.toString().indexOf(".html")!==-1?g+=" log-url":u.toString().indexOf(`
`)!==-1&&(r+="<br />"),r+=`
                    <span class="log-${typeof u} ${g}">`,typeof u=="object"&&typeof JSON=="object"&&typeof JSON.stringify=="function"?r+=JSON.stringify(u):r+=u,r+=" </span>"}n.innerHTML+=r+"</div>",i.apply(void 0,l)}},console.log=gt("log",console.oldLog),console.warn=gt("warn",console.oldWarn)})(es()),console.log(`
`,"╔═╗╔═╦╦═╗╔═╦═╦╦═╦═╗",`
`,"║╬╚╣║║║╬╚╣╬║║║║╬║╩╣",`
`,"╚══╩╩═╩══╣╔╩╩═╩═╩═╝",`
`,"─────────╚╝"),console.log(`Initialize Anapnoe UI/UX Core version ${Yn}`),console.log("UI/UX Backend Optimizations:",zt),console.log(navigator.userAgent),console.log(ks()),console.log("Console log enabled: ",window.opts.uiux_enable_console_log),console.log("Dev Mode enabled: ",window.opts.uiux_enable_dev_mode),console.log("Theme editor enabled: ",window.opts.uiux_enable_theme_editor),console.log("SD Styles enabled: ",window.opts.uiux_enable_sd_styles),console.log("Image Browser enabled: ",window.opts.uiux_enable_sd_output_images),console.log("Civitai Explorer enabled: ",window.opts.uiux_enable_civitai_explorer),console.log("Maximum resolution output: ",window.opts.uiux_max_resolution_output),console.log("Ignore overrides: ",window.opts.uiux_ignore_overrides),console.log("Show ticks for input range slider: ",window.opts.uiux_show_input_range_ticks),console.log("Default layout: ",window.opts.uiux_default_layout),console.log("Disable transitions: ",window.opts.uiux_disable_transitions),console.log("Aside labels: ",window.opts.uiux_show_labels_aside),console.log("Main labels: ",window.opts.uiux_show_labels_main),console.log("Tabs labels: ",window.opts.uiux_show_labels_tabs),console.log("Hide extra info for labels, checkboxes: ",window.opts.uiux_hide_extra_info),navigator.userAgent.toLowerCase().includes("firefox")&&console.log("Go to the Firefox about:config page, then search and toggle layout. css.has-selector. enabled"),window.opts.uiux_enable_console_log||(console.log=function(){});let t=document.querySelector("link[rel~='icon']");t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t)),t.href=`${Ft}favicon.svg/`}function Ms(e){e?(console.log=gt("log",console.oldLog),console.warn=gt("warn",console.oldWarn)):console.log=function(){}}async function $s(e){const t=[];return e.querySelectorAll(".template:not([status])").forEach(n=>{const s={},i=n.getAttribute("url");s.url=i||ts();const o=n.getAttribute("key");s.key=o||void 0;const a=n.getAttribute("template")||n.id;if(a)!zt&&a.includes("about")?s.template=`${a}-extension.html`:s.template=`${a}.html`;else{console.warn("Template not found on element:",n);return}s.id=n.id,s.extensionEnabled=Rs(s.template),t.push(s)}),t}function Rs(e){const t=Jn[e];return t?!!document.head.querySelector(`script[type="text/javascript"][src*="${t}"]`):!1}async function it(e,t){const n=e[t],s=t<e.length;if(!n)return;let i;if(n.template in Jn&&!n.extensionEnabled){console.log(`Skipping loading for extension template ${n.template} (extension disabled)`),await it(e,t+1);return}if(s){if(n!=null&&n.parent?i=n.parent:n!=null&&n.id&&(i=document.querySelector(`#${n.id}`)),i){const a=`${n.url}${n.template}`;try{const l=await fetch(a);if(l.ok){const r=await l.text(),u=document.createElement("div");if(n.key){const m=r.replace(/\s*\{\{.*?\}\}\s*/g,n.key);u.innerHTML=m}else u.innerHTML=r;const d=await $s(u);d.length>0&&(e=e.concat(d)),console.log("Template loaded",a),i.setAttribute("status","true"),i.append(u.firstElementChild),await it(e,t+1)}else l.status===404&&(console.error("404 template:",a),i.setAttribute("status","error"),await it(e,t+1))}catch(l){console.error("Error loading template:",l),i.setAttribute("status","error"),await it(e,t+1)}}}else console.log("Template files merged successfully")}async function Ds(){console.log("Loading Templates",Ve.gradio);const e=[{url:ts(),template:"template-app-root.html",parent:Qn()}];await it(e,0)}function He(e){if(e){const t=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function zs(e){if(e){const t=new Event("change",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function Fs(){const e=at();e.addEventListener("animationend",t=>{t.animationName==="fade-out"&&t.target.classList.add("hidden")}),e.addEventListener("animationstart",t=>{const n=e.classList.contains("notransition");t.animationName==="fade-out"?n&&t.target.classList.add("hidden"):t.animationName==="fade-in"&&t.target.classList.remove("hidden")})}async function Us(e,t=4){return new Promise(n=>{const s=i=>{e.value!=""||i>=t?n(!0):setTimeout(()=>s(i+1),500)};s(0)})}async function ot(e,t){const n=document.querySelector("#root-dock-components"),s=document.querySelector('#pnginfo_image input[type="file"]'),i=document.querySelector(`#pnginfo_send_buttons ${t}`),o=document.querySelector("#main-nav .active"),a=document.querySelector("#workspaces_tabitem"),l=document.querySelector('[data-selector="#tab_pnginfo textarea"] textarea');l&&(l.value="",He(l));try{const u=await(await fetch(e)).blob(),d=new File([u],"image.jpg"),m=new DataTransfer;m.items.add(d),s.files=m.files,zs(s),await Us(l)?(n&&(a.classList.add("no-redraw"),setTimeout(()=>{o==null||o.click(),a.classList.remove("no-redraw")},1e3)),i==null||i.click()):console.error("PNG info not loaded")}catch(r){console.error("Error:",r)}}function qs(e){let t;document.querySelectorAll(e).forEach(n=>{n.addEventListener("mouseenter",s=>{clearTimeout(t),n.classList.remove("init-view"),t=setTimeout(()=>{n.classList.add("mouseenter")},500)}),n.addEventListener("mouseleave",s=>{clearTimeout(t),n.classList.remove("mouseenter")})})}const Pe=typeof window<"u"?window:null,fn=Pe===null,bt=fn?void 0:Pe.document,ke="addEventListener",Oe="removeEventListener",Zt="getBoundingClientRect",ct="_a",Me="_b",We="_c",At="horizontal",$e=()=>!1,Hs=fn?"calc":`${["","-webkit-","-moz-","-o-"].filter(e=>{const t=bt.createElement("div");return t.style.cssText=`width:${e}calc(9px)`,!!t.style.length}).shift()}calc`,ns=e=>typeof e=="string"||e instanceof String,On=e=>{if(ns(e)){const t=bt.querySelector(e);if(!t)throw new Error(`Selector ${e} did not match a DOM element`);return t}return e},Se=(e,t,n)=>{const s=e[t];return s!==void 0?s:n},It=(e,t,n,s)=>{if(t){if(s==="end")return 0;if(s==="center")return e/2}else if(n){if(s==="start")return 0;if(s==="center")return e/2}return e},Bs=(e,t)=>{const n=bt.createElement("div");return n.className=`gutter gutter-${t}`,n},js=(e,t,n)=>{const s={};return ns(t)?s[e]=t:s[e]=`${Hs}(${t}% - ${n}px)`,s},Ws=(e,t)=>({[e]:`${t}px`}),Gs=(e,t={})=>{if(fn)return{};let n=e,s,i,o,a,l,r;Array.from&&(n=Array.from(n));const d=On(n[0]).parentNode,m=getComputedStyle?getComputedStyle(d):null,g=m?m.flexDirection:null;let E=Se(t,"sizes")||n.map(()=>100/n.length);const w=Se(t,"minSize",100),q=Array.isArray(w)?w:n.map(()=>w),I=Se(t,"maxSize",1/0),M=Array.isArray(I)?I:n.map(()=>I),f=Se(t,"expandToMin",!1),y=Se(t,"gutterSize",10),h=Se(t,"gutterAlign","center"),v=Se(t,"snapOffset",30),k=Array.isArray(v)?v:n.map(()=>v),W=Se(t,"dragInterval",1),ne=Se(t,"direction",At),H=Se(t,"cursor",ne===At?"col-resize":"row-resize"),A=Se(t,"gutter",Bs),p=Se(t,"elementStyle",js),C=Se(t,"gutterStyle",Ws);ne===At?(s="width",i="clientX",o="left",a="right",l="clientWidth"):ne==="vertical"&&(s="height",i="clientY",o="top",a="bottom",l="clientHeight");function $(x,_,T,N){const Z=p(s,_,T,N);Object.keys(Z).forEach(oe=>{x.style[oe]=Z[oe]})}function R(x,_,T){const N=C(s,_,T);Object.keys(N).forEach(Z=>{x.style[Z]=N[Z]})}function b(){return r.map(x=>x.size)}function S(x){return"touches"in x?x.touches[0][i]:x[i]}function z(x){const _=r[this.a],T=r[this.b],N=_.size+T.size;_.size=x/this.size*N,T.size=N-x/this.size*N,$(_.element,_.size,this[Me],_.i),$(T.element,T.size,this[We],T.i)}function V(x){let _;const T=r[this.a],N=r[this.b];this.dragging&&(_=S(x)-this.start+(this[Me]-this.dragOffset),W>1&&(_=Math.round(_/W)*W),_<=T.minSize+T.snapOffset+this[Me]?_=T.minSize+this[Me]:_>=this.size-(N.minSize+N.snapOffset+this[We])&&(_=this.size-(N.minSize+this[We])),_>=T.maxSize-T.snapOffset+this[Me]?_=T.maxSize+this[Me]:_<=this.size-(N.maxSize-N.snapOffset+this[We])&&(_=this.size-(N.maxSize+this[We])),z.call(this,_),Se(t,"onDrag",$e)(b()))}function J(){const x=r[this.a].element,_=r[this.b].element,T=x[Zt](),N=_[Zt]();this.size=T[s]+N[s]+this[Me]+this[We],this.start=T[o],this.end=T[a]}function se(x){if(!getComputedStyle)return null;const _=getComputedStyle(x);if(!_)return null;let T=x[l];return T===0?null:(ne===At?T-=parseFloat(_.paddingLeft)+parseFloat(_.paddingRight):T-=parseFloat(_.paddingTop)+parseFloat(_.paddingBottom),T)}function F(x){const _=se(d);if(_===null||q.reduce((oe,Q)=>oe+Q,0)>_)return x;let T=0;const N=[],Z=x.map((oe,Q)=>{const le=_*oe/100,he=It(y,Q===0,Q===x.length-1,h),pe=q[Q]+he;return le<pe?(T+=pe-le,N.push(0),pe):(N.push(le-pe),le)});return T===0?x:Z.map((oe,Q)=>{let le=oe;if(T>0&&N[Q]-T>0){const he=Math.min(T,N[Q]-T);T-=he,le=oe-he}return le/_*100})}function ie(){const x=this,_=r[x.a].element,T=r[x.b].element;x.dragging&&Se(t,"onDragEnd",$e)(b()),x.dragging=!1,Pe[Oe]("mouseup",x.stop),Pe[Oe]("touchend",x.stop),Pe[Oe]("touchcancel",x.stop),Pe[Oe]("mousemove",x.move),Pe[Oe]("touchmove",x.move),x.stop=null,x.move=null,_[Oe]("selectstart",$e),_[Oe]("dragstart",$e),T[Oe]("selectstart",$e),T[Oe]("dragstart",$e),_.style.userSelect="",_.style.webkitUserSelect="",_.style.MozUserSelect="",_.style.pointerEvents="",T.style.userSelect="",T.style.webkitUserSelect="",T.style.MozUserSelect="",T.style.pointerEvents="",x.gutter.style.cursor="",x.parent.style.cursor="",bt.body.style.cursor=""}function U(x){if("button"in x&&x.button!==0)return;const _=this,T=r[_.a].element,N=r[_.b].element;_.dragging||Se(t,"onDragStart",$e)(b()),x.preventDefault(),_.dragging=!0,_.move=V.bind(_),_.stop=ie.bind(_),Pe[ke]("mouseup",_.stop),Pe[ke]("touchend",_.stop),Pe[ke]("touchcancel",_.stop),Pe[ke]("mousemove",_.move),Pe[ke]("touchmove",_.move),T[ke]("selectstart",$e),T[ke]("dragstart",$e),N[ke]("selectstart",$e),N[ke]("dragstart",$e),T.style.userSelect="none",T.style.webkitUserSelect="none",T.style.MozUserSelect="none",T.style.pointerEvents="none",N.style.userSelect="none",N.style.webkitUserSelect="none",N.style.MozUserSelect="none",N.style.pointerEvents="none",_.gutter.style.cursor=H,_.parent.style.cursor=H,bt.body.style.cursor=H,J.call(_),_.dragOffset=S(x)-_.end}E=F(E);const K=[];r=n.map((x,_)=>{const T={element:On(x),size:E[_],minSize:q[_],maxSize:M[_],snapOffset:k[_],i:_};let N;if(_>0&&(N={a:_-1,b:_,dragging:!1,direction:ne,parent:d},N[Me]=It(y,_-1===0,!1,h),N[We]=It(y,!1,_===n.length-1,h),g==="row-reverse"||g==="column-reverse")){const Z=N.a;N.a=N.b,N.b=Z}if(_>0){const Z=A(_,ne,T.element);R(Z,y,_),N[ct]=U.bind(N),Z[ke]("mousedown",N[ct]),Z[ke]("touchstart",N[ct]),d.insertBefore(Z,T.element),N.gutter=Z}return $(T.element,T.size,It(y,_===0,_===n.length-1,h),_),_>0&&K.push(N),T});function j(x){const _=x.i===K.length,T=_?K[x.i-1]:K[x.i];J.call(T);const N=_?T.size-x.minSize-T[We]:x.minSize+T[Me];z.call(T,N)}r.forEach(x=>{const _=x.element[Zt]()[s];_<x.minSize&&(f?j(x):x.minSize=_)});function ce(x){const _=F(x);_.forEach((T,N)=>{if(N>0){const Z=K[N-1],oe=r[Z.a],Q=r[Z.b];oe.size=_[N-1],Q.size=T,$(oe.element,oe.size,Z[Me],oe.i),$(Q.element,Q.size,Z[We],Q.i)}})}function me(x,_){K.forEach(T=>{if(_!==!0?T.parent.removeChild(T.gutter):(T.gutter[Oe]("mousedown",T[ct]),T.gutter[Oe]("touchstart",T[ct])),x!==!0){const N=p(s,T.a.size,T[Me]);Object.keys(N).forEach(Z=>{r[T.a].element.style[Z]="",r[T.b].element.style[Z]=""})}})}return{setSizes:ce,getSizes:b,collapse(x){j(r[x])},destroy:me,parent:d,pairs:K}};class _t{constructor(){return _t.instance||(this.splitInstances={},_t.instance=this),_t.instance}set(t){Object.assign(this.splitInstances,t)}get(){return this.splitInstances}}const hn=new _t;Object.freeze(hn);function Vs(e){hn.set(e)}function Xs(){return hn.get()}async function Ys(e){const t=[];await Promise.all(Array.from(e.querySelectorAll("div.split")).map(async n=>{const s=n.id,i=e.querySelector(`#${s}`),o=(i==null?void 0:i.getAttribute("direction"))==="vertical"?"vertical":"horizontal",a=(i==null?void 0:i.getAttribute("gutterSize"))||"8",l=e.querySelectorAll(`#${s} > div.split-container`),r=Array.from(l).map(g=>{const E=g.getAttribute("data-initSize")?parseInt(g.getAttribute("data-initSize")):100/l.length,w=g.getAttribute("data-minSize")?parseInt(g.getAttribute("data-minSize")):1/0;return{id:`#${g.id}`,initSize:E,minSize:w}}),u=r.map(g=>g.id),d=r.map(g=>g.initSize),m=r.map(g=>g.minSize);console.log("Split component",u,d,m,o,a),t[s]=Gs(u,{sizes:d,minSize:m,direction:o,gutterSize:parseInt(a),snapOffset:0,dragInterval:1,elementStyle:(g,E,w)=>({"flex-basis":`calc(${E}% - ${w}px)`}),gutterStyle:(g,E)=>({"flex-basis":`${E}px`,"min-width":`${E}px`,"min-height":`${E}px`})})})),Vs(t)}const Rt={setItem:function(e,t){localStorage.setItem(e,t),this.notifyChange(e,t)},getItem:function(e){return localStorage.getItem(e)},removeItem:function(e){localStorage.removeItem(e),this.notifyChange(e,null)},notifyChange:function(e,t){const n=new CustomEvent("localStorageChange",{detail:{key:e,value:t}});window.dispatchEvent(n)}};function Zs(e,t){const n=Rt.getItem(t);e(t,n);const s=i=>{e(i.detail.key,i.detail.value)};return window.addEventListener("localStorageChange",s),()=>{window.removeEventListener("localStorageChange",s)}}let Kt=0;function Ks(e,t){const n=e.querySelectorAll("td:last-child"),s=document.createElement("style");let i=1,o="";n.forEach((a,l)=>{const r=parseFloat(a.textContent.trim());if(a.id=`td_${l}`,!isNaN(r)){let u;l===0?(i=r,u=100):u=r/i*100,o+=`#td_${l}::before { min-width: ${u}%; }`}}),s.textContent=o,t.appendChild(s)}function Js(e,t){e.querySelectorAll(`${t}, style`).forEach(s=>{e.removeChild(s)})}function Qs(e,t){const n=e.getAttribute("append-index");Array.from(e.children).forEach(i=>{if(i!==t)if(t.className.includes("gradio-accordion"))if(n){const o=parseInt(n,10);let a=t.children[2].children[o];t.children[2].insertBefore(i,a)}else t.children[2].append(i);else t.append(i)})}async function gn(e,t,n=0,s,i,o=!1){var d;const a=e.getAttribute("data-selector"),l=e.getAttribute("data-parent-selector");let r;if(n%2===0?r=document.querySelector(`${l} ${a}`):r=t.querySelector(`${a}`),r&&e){e.classList.contains("dynamic")&&(Js(e,a),a.includes("popup-table")&&Ks(r,e)),e.append(r),o&&Kt++,console.log("register | Ref",s,l,a),e.getAttribute("droppable")&&Qs(e,r);const g=e.getAttribute("show-button");g&&((d=document.querySelector(g))==null||d.classList.remove("hidden"))}else if(n<2){const m=e.getAttribute("data-timeout"),g=m?parseInt(m):500;await new Promise(E=>setTimeout(E,g)),console.log(n+1,"retry | ",g," | Ref",s,l,a),await gn(e,t,n+1,s,i,o)}else e.classList.contains("dynamic")?console.error("error | Ref",s,l,a):console.warn("dynamic | Ref",s,l,a),o&&Kt++;Kt===i&&o&&Rt.getItem("UiUxReady")==="false"&&(console.log("Runtime components initialized"),Rt.setItem("UiUxReady","true"))}async function ei(e){await Promise.all(Array.from(e.querySelectorAll(".portal:not(.dynamic)")).map(async(t,n,s)=>{gn(t,e,0,n,s.length,!0)}))}async function ti(e){const t=at();await Promise.all(Array.from(e.querySelectorAll(".xtabs-tab")).map(async s=>{if(s.addEventListener("click",()=>{const o=s.parentElement,a=s.getAttribute("tabGroup");s.getAttribute("data-click");const l=s.getAttribute("toggle"),r=s.classList.contains("active");function u(d){d.classList.remove("active");const m=d.getAttribute("tabItemId");t.querySelectorAll(m).forEach(g=>{g.classList.remove("fade-in","init-view"),g.classList.add("fade-out")})}if((!l||l&&r)&&(a?t.querySelectorAll(`[tabGroup="${a}"]`).forEach(d=>{d.classList.contains("active")&&u(d)}):o&&[].slice.call(o.children).forEach(m=>{m.classList.contains("active")&&u(m)})),!l||l&&!r){const d=s.getAttribute("tabItemId");t.querySelectorAll(d).forEach(m=>{m.classList.remove("fade-out"),m.classList.add("fade-in","init-view"),m.querySelectorAll(".portal.dynamic").forEach((g,E,w)=>{gn(g,document,0,E,w.length)})}),s.classList.add("active"),n(s)}}),!s.getAttribute("active")){const o=s.getAttribute("tabItemId");t.querySelectorAll(o).forEach(a=>{a.classList.remove("fade-in","init-view"),a.classList.add("fade-out")})}})),await Promise.all(Array.from(e.querySelectorAll(".xtabs-tab[active]")).map(async s=>{s.classList.add("active");const i=s.getAttribute("tabItemId");s.getAttribute("data-click"),t.querySelectorAll(i).forEach(o=>{o.classList.remove("fade-out"),o.classList.add("fade-in")}),n(s)}));function n(s,i,o){const a=s.closest(".accordion-bar");if(a){const l=a.parentElement;if(l.className.indexOf("expand")===-1){let r=a;const u=l.getAttribute("iconTrigger");if(u){const d=e.querySelector(u);d&&(r=d)}r.click()}}}}async function ni(e){await Promise.all(Array.from(e.querySelectorAll(".ae-button")).map(async t=>{const n=t.getAttribute("toggle"),s=t.getAttribute("active"),i=t.getAttribute("data-click"),o=t.querySelector("input");i&&t.addEventListener("click",a=>{const l=document.querySelector(i);l==null||l.click()}),o&&(o.checked===!0&&!s||o.checked===!1&&s)&&o.click(),s?t.classList.add("active"):t.classList.remove("active"),n&&t.addEventListener("click",a=>{const l=t.querySelector("input");l?(l.click(),l.checked===!0?t.classList.add("active"):l.checked===!1&&t.classList.remove("active")):t.classList.toggle("active")})}))}async function si(e){const t=Xs();await Promise.all(Array.from(e.querySelectorAll(".accordion-bar")).map(async n=>{const s=n.parentElement,i=s.closest(".split-container");let o=n;const a=s.getAttribute("iconTrigger");if(a){const l=e.querySelector(a);l&&(o=l,n.classList.add("pointer-events-none"))}if(s.className.indexOf("accordion-vertical")!==-1&&i.className.indexOf("split")!==-1){s.classList.add("expand");const l=i.parentElement.id,r=t[l];i.setAttribute("data-sizes",JSON.stringify(r.getSizes())),o==null||o.addEventListener("click",()=>{if(s.classList.toggle("expand"),i.className.indexOf("v-expand")!==-1)i.classList.remove("v-expand"),r.setSizes(JSON.parse(i.getAttribute("data-sizes")));else{i.classList.add("v-expand");let u=r.getSizes();i.setAttribute("data-sizes",JSON.stringify(u)),console.log(u),u[u.length-1]=0,u[u.length-2]=100;const d=parseFloat(window.getComputedStyle(n,null).getPropertyValue("padding-left"))*2;i.style.minWidth=n.offsetWidth+d+"px",r.setSizes(u)}})}else o==null||o.addEventListener("click",()=>{s.classList.toggle("expand")})}))}async function ss(e){var n;await Ys(e),await ei(e),await si(e),await ti(e),await ni(e),document.querySelector("#container-console-log").append(es()),(n=document.querySelector("#logger_screen"))==null||n.remove()}const Mn={ANAPNOE_APP_VER:Yn,DEFAULT_PATH:Zn,FOCUS_PROMPT:"txt2img",loadCurrentTemplate:it,initUiUxComponents:ss};async function ii(){document.head.querySelectorAll(`
        [rel="stylesheet"][href*="/assets/"],
        [rel="stylesheet"][href*="theme.css"],
        [rel="stylesheet"][href*="index"]`).forEach(s=>{s.remove(),console.log("Remove stylesheet",s.getAttribute("href"))}),document.body.querySelectorAll(`
        [rel="stylesheet"][href*="file=style.css"]`).forEach(s=>{s.remove(),console.log("Remove stylesheet",s.getAttribute("href"))});const e=document.querySelectorAll('.styler, [class*="svelte"]:not(input)'),t=e.length;let n=0;e.forEach(s=>{s.style.display!=="none"&&s.style.display!=="block"&&(s.removeAttribute("style"),n++),[...s.classList].filter(i=>i.match(/^svelte.*/)).forEach(i=>s.classList.remove(i))}),console.log("Remove inline styles from DOM","Total Selectors:",t,"Removed Selectors:",n)}async function oi(){var e,t,n,s,i,o,a,l;if(!zt){const r=Ye();console.log("Remove Extra Networks Instances"),(e=r.querySelector("#img2img_textual_inversion_cards_html"))==null||e.remove(),(t=r.querySelector("#img2img_checkpoints_cards_html"))==null||t.remove(),(n=r.querySelector("#img2img_hypernetworks_cards_html"))==null||n.remove(),(s=r.querySelector("#img2img_lora_cards_html"))==null||s.remove(),(i=r.querySelector("#txt2img_textual_inversion_cards_html"))==null||i.remove(),(o=r.querySelector("#txt2img_checkpoints_cards_html"))==null||o.remove(),(a=r.querySelector("#txt2img_hypernetworks_cards_html"))==null||a.remove(),(l=r.querySelector("#txt2img_lora_cards_html"))==null||l.remove(),console.log("Remove element #img2img_textual_inversion_cards_html"),console.log("Remove element #img2img_checkpoints_cards_html"),console.log("Remove element #img2img_hypernetworks_cards_html"),console.log("Remove element #img2img_lora_cards_html"),console.log("Remove element #txt2img_textual_inversion_cards_html"),console.log("Remove element #txt2img_checkpoints_cards_html"),console.log("Remove element #txt2img_hypernetworks_cards_html"),console.log("Remove element #txt2img_lora_cards_html")}}async function ai(e=mn,t=1){return await(await fetch(`https://api.github.com/repos/${e}/contributors?per_page=100&page=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()}async function is(e=mn,t=1,n=[]){const s=await ai(e,t);return n=n.concat(s),s.length===100?is(e,t+1,n):n}function ri(){const e=document.querySelector("#contributors"),t=document.querySelector("#contributors_tabitem"),n=document.createElement("div");n.className="flexbox col padding lrp-32",n.innerHTML=`Kindly allow us a moment to retrieve the contributors. 
    We're grateful for the many individuals who have generously put their time and effort to make this possible.`,t.append(n),e.addEventListener("click",s=>{e.getAttribute("data-visited")||(e.setAttribute("data-visited","true"),is().then(o=>{n.innerHTML="";const a=document.createElement("div");a.id="contributors_grid";for(let l=0;l<o.length;l++){const r=o[l].login,u=o[l].html_url,d=o[l].avatar_url;a.innerHTML+=`
                        <a href="${u}" target="_blank" rel="noopener noreferrer nofollow" class="contributor-button flexbox col">
                            <figure><img src="${d}" lazy="true"></figure>
                            <div class="contributor-name">
                                ${r}
                            </div>
                        </a>`}n.append(a)}))})}async function os(e,t){try{const n=await fetch(e);if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const s=await n.json();t(s)}catch(n){console.error("Failed to fetch metadata:",n)}}async function qe(e,t,n){try{const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const i=await s.json();n(i)}catch(s){console.error("Failed to fetch data:",s)}}async function li(e=1){return await(await fetch(`https://app.buymeacoffee.com/api/creators/slug/dayanbayah/coffees?per_page=20&page=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()}async function as(e=1,t=[]){const n=await li(e);return t=t.concat(n.data),n.data.length>0?as(e+1,t):t}function ci(e){const n=Date.now()-2592e6,s=new Map,i=(r,u)=>{const d=new Date(r),m=new Date(u);let g=(m.getFullYear()-d.getFullYear())*12;g+=m.getMonth()-d.getMonth();const E=d.getDate();return m.getDate()<E&&g--,Math.max(1,g)};e.forEach(r=>{const u=r.fk_user_id,d=new Date(r.support_created_on),m=new Date(r.support_updated_on);if(!s.has(u))s.set(u,{...r,periods:[{startDate:d,endDate:m}],firstCreated:d,lastUpdated:m});else{const g=s.get(u);g.periods.push({startDate:d,endDate:m}),d<g.firstCreated&&(g.firstCreated=d),m>g.lastUpdated&&(g.lastUpdated=m)}});for(const r of s.values()){r.periods.sort((d,m)=>d.startDate-m.startDate);const u=[r.periods[0]];for(let d=1;d<r.periods.length;d++){const m=u[u.length-1],g=r.periods[d];g.startDate<=m.endDate?m.endDate=g.endDate>m.endDate?g.endDate:m.endDate:u.push(g)}r.num_months_support=u.reduce((d,m)=>d+i(m.startDate,m.endDate),0),r.support_created_on=r.firstCreated,r.support_updated_on=r.lastUpdated}const o=[],a=[];for(const r of s.values()){const u={...r,support_created_on:r.support_created_on.toISOString(),support_updated_on:r.support_updated_on.toISOString(),num_months_support:r.num_months_support};r.lastUpdated.getTime()>=n?o.push(u):a.push(u)}o.sort((r,u)=>u.num_months_support-r.num_months_support),a.sort((r,u)=>u.num_months_support-r.num_months_support);const l=({periods:r,firstCreated:u,lastUpdated:d,...m})=>m;return{currentMembers:o.map(l),pastMembers:a.map(l)}}function $n(e){let t=e.supporter_name;const n=e.profile_picture_url,s=n.includes("/default")?`https://robohash.org/${e.fk_user_id}`:n;return e.fk_user_id=="7367914"&&(t="Bruce"),`
        <a href="#" target="_blank" rel="noopener noreferrer nofollow" class="sponsors-button flexbox col">
            <figure style="background-image: url(${s})" lazy="true"></figure>
            <div class="sponsors-name">
                ${t} 
            </div>
            <span class="sponsors-coffee">
                ${e.num_months_support}
            </span>
        </a>`}function di(){const e=document.querySelector("#sponsors"),t=document.querySelector("#sponsors_tabitem"),n=document.createElement("div");n.className="flexbox col padding lrp-32",n.innerHTML="Kindly allow us a moment to retrieve our sponsors.",t.append(n),e.addEventListener("click",s=>{e.getAttribute("data-visited")||(e.setAttribute("data-visited","true"),as().then(o=>{n.innerHTML="";const a=document.createElement("div");a.innerHTML=`
                <h2>Current Supporters</h2>
                <p>We're deeply grateful to the individuals currently supporting this project through their sponsorships.</p>
                `,n.append(a);const l=document.createElement("div");l.className="sponsors_grid current";const r=ci(o),u=r.currentMembers;for(let E=0;E<u.length;E++)l.innerHTML+=$n(u[E]);n.append(l);const d=document.createElement("div");d.innerHTML=`
                <br><br><br>
                <h2>Former Supporters</h2>
                <p>We extend our sincere appreciation to all who have generously sponsored this initiative in the past.</p>
                `,n.append(d);const m=r.pastMembers,g=document.createElement("div");g.className="sponsors_grid",g.innerHTML="";for(let E=0;E<m.length;E++)g.innerHTML+=$n(m[E]);n.append(g)}))})}const Rn=()=>window.innerWidth<=768,Pt=e=>{var n;const t=at();t.querySelectorAll("[mobile]").forEach(s=>{if(e){if(s.childElementCount===0){const i=s.getAttribute("mobile");if(i){const o=t.querySelector(i);o&&(s.setAttribute("mobile-restore",`#${o.parentElement.id}`),s.append(o))}}}else if(s.childElementCount>0){const i=s.getAttribute("mobile-restore");if(i){const o=t.querySelector(i);o&&o.append(s.firstElementChild)}}}),e?((n=t.querySelector(".accordion-vertical.expand #mask-icon-acc-arrow"))==null||n.click(),t.classList.add("default-mobile")):t.classList.remove("default-mobile")},ui=()=>{const e=at(),t=window.opts.uiux_default_layout;e.classList.add(`default-${t.toLowerCase()}`),t==="Auto"?(window.addEventListener("resize",n=>{Pt(Rn())}),Pt(Rn())):Pt(t==="Mobile")};function mi(){const e=at(),t=Ye();if(!e||!t){console.warn(`Required elements not found: ${e?"":"anapnoeApp"} ${t?"":"gradioApp"}`);return}t.querySelector("#setting_uiux_mobile_scale input[type=range]").classList.add("hidden");const s=t.querySelector("#setting_uiux_mobile_scale input[type=number]");function i(f){document.head.querySelector('meta[name="viewport"]').setAttribute("content",`width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=${f}`)}s.addEventListener("change",f=>{s.value=f.target.value,He(s),i(f.target.value)}),i(window.opts.uiux_mobile_scale);function o(f){t.querySelectorAll('[id$="2img_width"] input,[id$="2img_height"] input').forEach(y=>{y.max=f})}t.querySelector("#setting_uiux_max_resolution_output").addEventListener("input",f=>{let y=parseInt(f.target.value);y=Math.min(Math.max(y,512),16384),o(y)}),o(window.opts.uiux_max_resolution_output);function a(f){f.forEach(y=>{const h=y.step/(y.max-y.min)*100,v=`max(3px, calc(${h}% - 1px))`,k=`max(4px, calc(${h}% + 0px))`;y.style.setProperty("--ae-slider-bg-overlay",`repeating-linear-gradient(90deg, transparent, transparent ${v}, var(--ae-input-border-color) ${v}, var(--ae-input-border-color) ${k})`)})}function l(f,y){const v=t.querySelectorAll("input[type='range']");f?a(v):y&&v.forEach(k=>{k.style.setProperty("--ae-slider-bg-overlay","transparent")})}t.querySelector("#setting_uiux_show_input_range_ticks input").addEventListener("click",f=>{l(f.target.checked,!0)}),l(window.opts.uiux_show_input_range_ticks);function u(){const f=Array.from(t.querySelectorAll("#setting_uiux_ignore_overrides input:checked")).map(h=>h.nextElementSibling.innerHTML);t.querySelectorAll("[id$='2img_override_settings'] .token").forEach(h=>{var W;const[v,k]=h.querySelector("span").textContent.split(":").map(ne=>ne.trim());f.includes(v)&&(t.querySelector("[id$='2img_override_settings']").classList.add("show"),(W=h.querySelector(".token-remove"))==null||W.click())})}t.querySelector("#setting_uiux_ignore_overrides").addEventListener("click",()=>{setTimeout(u,100)});const d=new MutationObserver(f=>{f.forEach(y=>{y.type==="attributes"&&y.attributeName==="class"&&setTimeout(u,1e3)})}),m=new MutationObserver(f=>{f.forEach(y=>{y.addedNodes.length&&setTimeout(u,1e3)})});document.querySelectorAll("#txt2img_override_settings .wrap-inner, #img2img_override_settings .wrap_inner").forEach(f=>m.observe(f,{childList:!0})),document.querySelectorAll("#txt2img_nav, #img2img_nav").forEach(f=>d.observe(f,{attributes:!0}));function w(f,y){const h=t.querySelector(`${f} input`);if(h){const v=f.split("#setting_")[1],k=window.opts[v];e.classList.toggle(y,k),localStorage.setItem(v,k),h.addEventListener("click",W=>{localStorage.setItem(v,W.target.checked),e.classList.toggle(y,W.target.checked),v==="uiux_enable_console_log"&&Ms(W.target.checked)})}}const q=[{key:"#setting_uiux_no_slider_layout",className:"no-slider-layout"},{key:"#setting_uiux_show_labels_aside",className:"aside-labels"},{key:"#setting_uiux_show_labels_main",className:"main-labels"},{key:"#setting_uiux_show_labels_tabs",className:"tab-labels"},{key:"#setting_uiux_hide_extra_info",className:"no-extra-info"},{key:"#setting_uiux_disable_transitions",className:"notransition"},{key:"#setting_uiux_enable_console_log",className:"debug-log"}];for(const{key:f,className:y}of q)w(f,y);function I(f,y){e.style.setProperty(f,y)}const M=["#setting_uiux_exnet_fit_size","#setting_uiux_exnet_aspect_ratio_x","#setting_uiux_exnet_aspect_ratio_y","#setting_uiux_exnet_header_size","#setting_uiux_min_wrap_size","#setting_uiux_exnet_image_tint"];for(const f of M){const y=document.querySelector(`${f} input[type=number]`),h=document.querySelector(`${f} input[type=range]`);if(h&&h.classList.add("hidden"),y){const v=f.split("#setting_")[1],k=`--ae-${v}`,W=window.opts[v];I(k,W),y.addEventListener("change",ne=>{He(y),I(k,ne.target.value)})}}}function pi(){["#txt2img","#img2img","#deforum"].forEach(t=>{var s;const n=document.querySelector(`${t}_generate`);if(n){(s=document.querySelector(`${t}_nav`))==null||s.classList.remove("hidden");const i=document.querySelector(`${t}_interrupt`),o=i.closest(".portal"),a=n.closest(".ae-button"),l=document.querySelector(`${t}_skip`).closest(".portal"),r=document.querySelector(`${t}_loop`);i.addEventListener("click",()=>{r==null||r.classList.add("stop")}),new MutationObserver(d=>{d.forEach(m=>{const g=i.style.display==="none",E=()=>{const w=document.querySelector(".progressDiv .progress");if(g){if(w){setTimeout(()=>{i.click(),E()},500);return}if(r){const q=r.classList.contains("active");r.classList.contains("stop")||!q?(r.classList.remove("stop"),o.classList.add("disable"),l==null||l.classList.add("disable"),a.classList.remove("active"),n.classList.remove("disable")):q&&(n.click(),n.classList.add("disable"))}else o.classList.add("disable"),a.classList.remove("active"),n.classList.remove("disable")}else o.classList.remove("disable"),l==null||l.classList.remove("disable"),a.classList.add("active"),n.classList.add("disable")};E()})}).observe(i,{attributes:!0,attributeFilter:["style"]})}})}function fi(e){const t=document.querySelector("#setting_sd_model_checkpoint .wrap .secondary-wrap input")||document.querySelector(".gradio-dropdown.model_selection .wrap .secondary-wrap input"),n=document.querySelector("#setting_sd_model_checkpoint .wrap")||document.querySelector(".gradio-dropdown.model_selection .wrap"),s=document.querySelector("#checkpoints_main_footer_db .model-selected");document.querySelector("#checkpoints_main_footer_db .model-preloader").append(n);let o="",a=null,l=null;const r=d=>{if(o!==d){const m=d.split(".").slice(0,-1).join(".");e.selected=new Set([m]),e.forceRenderItems(),typeof l=="function"&&l(e.selected),s.textContent=d,console.log("Checkpoint:",d,m),o=d}};return r(t.value),(()=>{a||(a=new MutationObserver(()=>{setTimeout(()=>r(t.value),1e3)}),a.observe(t,{attributes:!0}),a.observe(n,{childList:!0,subtree:!0}))})(),{setTreeViewCallback(d){l=d,r(o)},destroy(){a&&a.disconnect()}}}function vt(e,t,n,s=null){return Object.keys(e).forEach(i=>{const o=document.querySelector(`${i}`);if(o){const a=e[i],l=o.tagName==="SELECT"&&o.multiple||o.tagName==="SELECT"||o.type==="checkbox"||o.type==="radio"||o.type!=="range"&&o.type!=="color"&&o.type!=="text"?"change":"input",r=()=>{let u;o.tagName==="SELECT"&&o.multiple?(u=Array.from(o.selectedOptions).map(m=>m.value),t[a]=u):o.type==="checkbox"||o.type==="radio"?u=o.checked:u=o.value;const d=s?s({[a]:u}):{[a]:u};n.updateParamsAndFetch(d,1e3)};o.addEventListener(l,r)}else console.warn(`Input element with id ${i} not found.`)}),t}function hi(){const e=getComputedStyle(document.documentElement).getPropertyValue("--ae-main-bg-color").trim(),t=getComputedStyle(document.documentElement).getPropertyValue("--ae-primary-color").trim(),n=t.replace(/#/g,"%23"),s=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <polygon fill="${n}" points="19.5,13.7 21.6,9.9 11.8,9.9 16.7,18.5 17.7,16.7 17.1,15.7 16.7,16.5 13.5,10.9 19.9,10.9 18.9,12.7"/>
            <polygon fill="${n}" points="17.3,11.7 15.8,11.7 20.2,19.3 3.8,19.3 12,5.2 14.2,9 15.8,9 12,2.5 1.5,20.7 22.5,20.7"/>
        </svg>
        `.replace(/\n\s+/g," "),o=`url("data:image/svg+xml,${encodeURIComponent(s)}")`;document.documentElement.style.cssText=`
        background-position: 50% 40%;
        background-size: 200px;
        background-repeat: no-repeat;
        background-color: ${e} !important;
        background-image: ${o} !important;
        color: ${t};
        height: 100%;
    `}function Dn(e){let t=e.startsWith("#")?e.slice(1):e,n=1;if(t.length===8?(n=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6)):t.length===3&&(t=t.split("").map(i=>i+i).join("")),t.length!==6)throw new Error("Invalid HEX color.");const s=t.match(/.{2}/g).map(i=>parseInt(i,16));return s.push(n),s}function Mt(e){const t=e[0]/255,n=e[1]/255,s=e[2]/255,i=Math.max(t,n,s),o=Math.min(t,n,s),a=i-o,l=i+o,r=o===i?0:t===i?(60*(n-s)/a+360)%360:n===i?60*(s-t)/a+120:60*(t-n)/a+240,u=.5*l,d=u===0?0:u===1?1:u<=.5?a/l:a/(2-l),m=e.length===4?e[3]:1;return[Math.round(r),Math.round(d*100),Math.round(u*100),m]}function cn(e,t,n,s=1){n/=100;const i=(s*255|256).toString(16).slice(1),o=a=>{const l=(a+e/30)%12,r=n-t*Math.min(n,1-n)/100*Math.max(Math.min(l-3,9-l,1),-1);return Math.round(255*Math.max(0,Math.min(r,1))).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}${i}`}function zn(e){e.startsWith("#")&&(e=e.slice(1));let t=1;if(e.length===8&&(t=parseInt(e.slice(6,8),16)/255,e=e.slice(0,6)),e.length===3&&(e=e.split("").map(o=>o+o).join("")),e.length!==6)throw new Error("Invalid HEX color.");const n=(255-parseInt(e.slice(0,2),16)).toString(16),s=(255-parseInt(e.slice(2,4),16)).toString(16),i=(255-parseInt(e.slice(4,6),16)).toString(16);return`#${Nt(n)}${Nt(s)}${Nt(i)}${Nt(Math.round(t*255).toString(16))}`}function Nt(e,t=2){return(new Array(t).join("0")+e).slice(-t)}const Ae={};let yt,dt=[0,0,0,0];const Dt=e=>e.match(/[\d.]+/g).map(Number);function gi(e,t,n,s){let i;if(n.includes("#")){let d=n.replace(/\s+/g,"");yt&&(d=zn(d),Ae[t]=d),i=Mt(Dn(d))}else if((n.includes("hsl")||n.includes("rgb"))&&(i=n.includes("rgb")?Mt(Dt(n)):Dt(n),yt)){const d=cn(i[0],i[1],i[2],i[3]);Ae[t]=zn(d),i=Mt(Dn(Ae[t]))}const o=((Number(i[0])||0)+(Number(s[0])||0))%360,a=Math.min(Math.max((Number(i[1])||0)+(Number(s[1])||0),0),100),l=Math.min(Math.max((Number(i[2])||0)+(Number(s[2])||0),0),100),r=Math.min(Math.max((Number(i[3])||1)+(Number(s[3])||0),0),1),u=cn(o,a,l,r).slice(0,-2);return e.value=u,`hsla(${o}, ${a}%, ${l}%, ${r})`}function Jt(e){let t="";for(const i in Ae){const o=Ae[i];if(i!=""&&o&&o.length>0){const a=document.body.querySelector(`#${i} input`)||document.body.querySelector(`#${i} textarea`);if(a)if((a.type||"text")==="color"){const r=gi(a,i,o,e);t+=`${i}:${r};`}else t+=`${i}:${Ae[i]};`}}yt=!1;const n=document.body.querySelector("#preview-styles");n.innerHTML=`:root {${t}}`,n.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";const s=document.body.querySelector("#theme_vars textarea");s.value=t,window.updateInput(s)}function Qt(e){let t="";for(let o=0;o<e.length-1;o++){const[a,l]=e[o].split(":").map(d=>d.trim()),r=a.replace(/\s+/g,"");Ae[r]=l,t+=`${r}:${l};`,document.body.querySelectorAll(`#${r} input, #${r} textarea`).forEach(d=>{const m=d.type||"text";if(m==="color")if(l.includes("hsl")||l.includes("rgb")){let g;l.includes("rgb")?g=Mt(Dt(l)):g=Dt(l),d.value=cn(g[0],g[1],g[2],g[3]).slice(0,-2)}else d.value=l;else m==="number"||m==="range"?d.value=parseFloat(l)||0:(m==="textarea"||m==="text")&&(d.value=l)})}const n=document.body.querySelector("#preview-styles");if(n)n.innerHTML=`:root {${t}}`,n.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }";else{const o=document.createElement("style");o.id="preview-styles",o.innerHTML=`:root {${t}}`,o.innerHTML+="@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }",document.body.appendChild(o)}const s=document.body.querySelector("#theme_vars textarea"),i=document.body.querySelector("#theme_css textarea");s.value=t,window.updateInput(s),window.updateInput(i)}function _i(e){const t=e.split("/*BREAKPOINT_CSS_CONTENT*/");let n=t[0].split("}")[0].split("{")[1].replace(/\n|\r/g,"");n=n.replace(/;+/,";").trim();const s=n.split(";"),i=document.body.querySelector("#theme_vars textarea"),o=document.body.querySelector("#theme_css textarea");i.value=n,window.updateInput(i);const a=t[1]!==void 0?t[1]:"";o.value=`/*BREAKPOINT_CSS_CONTENT*/${a}/*BREAKPOINT_CSS_CONTENT*/`,Qt(s);const l=document.body.querySelector("#preview-styles");if(!l){const I=document.createElement("style");I.id="preview-styles",I.innerHTML=e,document.body.appendChild(I)}let r;function u(I){let M=I.value,f=I.parentElement,y=I.type||"text";y==="range"||y==="number"?(f=I.closest(".gradio-slider")||I.closest(".gradio-number"),M+=f.id.indexOf("angle")!==-1?"deg":f.id.indexOf("slider-height")===-1?"px":"",Ae[f.id]=M):y==="color"?(f=I.closest(".gradio-colorpicker"),Ae[f.id]=M):y==="textarea"?(f=I.closest(".gradio-textbox"),M.length>0?Ae[f.id]=M:delete Ae[f.id]):y==="text"&&(f=I.closest(".gradio-dropdown"),f&&(Ae[f.id]=M)),r!=null&&clearInterval(r),r=setTimeout(()=>{let h=Object.entries(Ae).map(([v,k])=>`${v}:${k};`).join("");i.value=h,l.innerHTML=`:root {${h}}@media only screen and (max-width: 860px) { :root { --ae-outside-gap-size: var(--ae-mobile-outside-gap-size); --ae-inside-padding-size: var(--ae-mobile-inside-padding-size); } }`,window.updateInput(i),Jt(dt)},1e3)}document.body.querySelectorAll("#ui_theme_settings input, #ui_theme_settings textarea").forEach(I=>{I.addEventListener("input",M=>{u(M.currentTarget)})});const d=new MutationObserver(I=>{I.forEach(M=>{M.removedNodes.forEach(f=>{f.nodeType===1&&f.matches("ul")&&u(M.target.querySelector(".secondary-wrap input"))})})});document.body.querySelectorAll("#ui_theme_settings .gradio-dropdown").forEach(I=>{d.observe(I,{childList:!0,subtree:!0})}),document.getElementById("theme_reset_btn").addEventListener("click",I=>{I.preventDefault(),document.body.querySelectorAll("#ui_theme_hsv input").forEach(M=>{M.value=0}),dt=[0,0,0],Qt(s)});let g;function E(){if(n!==i.value){clearInterval(g),n=i.value.replace(/\n|\r/g,""),n=n.split(":root{")[0],i.value=n;const I=n.split(";");Qt(I)}}document.body.querySelector("#themes_drop_down input").addEventListener("click",I=>{g!==null&&clearInterval(g),i.value=n,g=setInterval(E,500)}),document.body.querySelectorAll("#theme_hue input, #theme_sat input, #theme_brt input").forEach((I,M)=>{I.addEventListener("change",f=>{f.preventDefault(),dt[Math.floor(M/2)]=f.currentTarget.value,Jt(dt)})}),document.getElementById("theme_invert_btn").addEventListener("click",I=>{I.preventDefault(),yt=!yt,Jt(dt)})}function Fn(e){var s;const n=(s=Array.from(e.sheet.cssRules).filter(i=>i instanceof CSSStyleRule&&i.selectorText===":root")[0])==null?void 0:s.cssText;n&&_i(n)}function bi(){const e=document.querySelector('[rel="stylesheet"][href*="user"]');if(Ye().querySelector('[id^="tab_ui_theme"]')&&e){Fn(e);return}const n=new MutationObserver(()=>{const s=document.querySelector('[rel="stylesheet"][href*="user"]');if(Ye().querySelector('[id^="tab_ui_theme"]'))if(s)n.disconnect(),setTimeout(()=>{Fn(s)},500);else{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href="./file=user.css",document.head.appendChild(o)}});n.observe(Ye(),{childList:!0,subtree:!0})}function Je(e,t,n=10,s={title:"username",url:"url"},i="",o={},a="POST"){this.container=e,this.originalData=t,this.data=t,this.itemsPerPage=n,this.optItemsPerPage=n,this.apiUrl=i,this.method=a,this.params=o,this.limit=o.limit,this.keys=s,this.startIndex=0,this.renderedItems={},this.lastScrollPos=0,this.isFetching=!1,this.useDataFetching=!0,this.isInit=!1,this.resolvedRenderMethod=this.renderItems,this.selected,this.smoothScrolling=!0,this.activePointers={},this.zoom_scale=1,this.scrollDelta=0,this.x=this.y=0,this.renderedRange={start:-1,end:-1},this.pendingRender=null,this.scrollEndTimer=null,this.lastScrollEventTime=0,this.createContainer(),this.createSentinels(),this.createDetail(),this.setLayout("vertical"),this.initialize()}Object.assign(Je.prototype,{initialize(){(!this.apiUrl||this.apiUrl.includes(".json"))&&(this.useDataFetching=!1),this.isInit?this.data.length>0?(this.itemsWrapper.classList.remove("hidden"),this.updateDimensions(!0)):this.itemsWrapper.classList.add("hidden"):this.data.length>0&&(this.isInit=!0,this.resolvedRenderMethod(),this.setupEventListeners(),this.setupResizeObserver(),this.updateDimensions())},setFullSize(e){this.isFullSize=e,e?this.container.classList.add("full"):this.container.classList.remove("full")},setTileable(e){this.isTileable=e,e?this.container.classList.add("tileable"):this.container.classList.remove("tileable")},setInfo(e){this.isInfo=e,e?this.container.classList.add("info"):this.container.classList.remove("info")},setFullScreen(e){this.isFullScreen=e,e?this.container.requestFullscreen&&(this.container.parentElement.requestFullscreen(),this.container.classList.add("fullscreen")):document.exitFullscreen&&(document.exitFullscreen(),this.container.classList.remove("fullscreen"))},setLayout(e){e==="horizontal"?(this.direction="horizontal",this.translateProp="translateX",this.scrollProp="scrollLeft",this.client="clientX",this.scrollSize="scrollWidth",this.container.classList.remove("vertical"),this.container.classList.add("horizontal")):(this.direction="vertical",this.translateProp="translateY",this.scrollProp="scrollTop",this.client="clientY",this.scrollSize="scrollHeight",this.container.classList.remove("horizontal"),this.container.classList.add("vertical"))},createContainer(){this.container.classList.add("ae-virtual","visible",this.direction||"vertical"),this.itemsWrapper=document.createElement("div"),this.itemsWrapper.classList.add("ae-virtual-wrapper"),this.container.appendChild(this.itemsWrapper)},createSentinel(){const e=document.createElement("div");return e.classList.add("sentinel"),e},createSentinels(){this.maxSentinel=this.createSentinel(),this.totalSizeSentinel=this.createSentinel(),this.container.append(this.maxSentinel,this.totalSizeSentinel)},createDetail(){this.detail=document.createElement("div"),this.detail.className="ae-virtual-detail";const e=document.createElement("button");e.className="ae-button close";const t=document.createElement("div");t.className="mask-icon icon-cancel",e.appendChild(t),this.detail.appendChild(e);const n=document.createElement("div");n.className="ae-virtual-detail-content",this.detail.appendChild(n),this.container.parentElement.appendChild(this.detail),e.addEventListener("click",this.hideDetail.bind(this)),this.hideDetail()},createItemElement(e,t){const n=document.createElement("div");n.className="item card";const s=e[this.keys.url];s&&(n.style.backgroundImage=`url(${s})`);const i=document.createElement("span");return i.textContent=e[this.keys.title],i.className="title",n.appendChild(i),n},getItemsToRender(){const e=Math.max(0,this.startIndex),t=Math.min(this.data.length,e+this.itemsPerPage);return{start:e,end:t}},renderItems(e="increase"){this.pendingRender&&(cancelAnimationFrame(this.pendingRender),this.pendingRender=null);const{start:t,end:n}=this.getItemsToRender();this.renderedRange.start===t&&this.renderedRange.end===n||(this.pendingRender=requestAnimationFrame(()=>{const s=performance.now();this._executeRender(t,n,e);const i=performance.now()-s;i>2&&console.warn(`Render time: ${i.toFixed(2)}ms`),this.renderedRange={start:t,end:n},this.pendingRender=null}))},_executeRender(e,t,n){const s=new Set,i=document.createDocumentFragment();for(let o=e;o<t;o++)if(s.add(o),!this.renderedItems[o]){const a=this.data[o];if(!a)continue;const l=this.createItemElement(a,o);l.dataset.index=o,l.dataset.id=a.id,i.appendChild(l),this.renderedItems[o]=l}i.childElementCount>0&&(n==="increase"?this.itemsWrapper.appendChild(i):this.itemsWrapper.insertBefore(i,this.itemsWrapper.firstChild));for(const o in this.renderedItems)s.has(Number(o))||(this.renderedItems[o].remove(),delete this.renderedItems[o]);this.renderedRange={start:e,end:t},this.updateSentinels()},forceRenderItems(){try{this.itemsWrapper.innerHTML="",this.renderedItems={},this.renderedRange={start:-1,end:-1},this.renderItems()}catch(e){console.error("Force render error:",e)}},updateSentinels(){const e=Math.max(0,this.startIndex),t=Math.min(this.data.length,this.startIndex+this.itemsPerPage),n=e/this.itemsPerRow*this.itemSize;let s=t/this.itemsPerRow*this.itemSize;s=Math.min(s,this.totalSize),s=Math.round(s/this.itemSize)*this.itemSize,this.maxSentinel.style.transform=`${this.translateProp}(${s}px)`,this.itemsWrapper.style.transform=`${this.translateProp}(${n}px)`},updateDimensions(e=!1){const t=this.itemsWrapper.querySelector(".item");if(!t||(this.itemHeight=t.offsetHeight,this.itemWidth=t.offsetWidth,this.containerWidth=this.container.parentElement.offsetWidth,this.containerHeight=this.container.parentElement.offsetHeight,console.log("this.updateDimensions",this.containerWidth,this.containerHeight),!this.containerWidth)||!this.containerHeight||!this.data.length)return;const n=this.total||this.data.length;this.direction==="horizontal"?(this.itemSize=this.itemWidth,this.containerSize=this.containerWidth,this.itemsPerRow=Math.floor(this.containerHeight/this.itemHeight),this.rowsInView=Math.ceil(this.containerWidth/this.itemWidth)):(this.itemSize=this.itemHeight,this.containerSize=this.containerHeight,this.itemsPerRow=Math.floor(this.containerWidth/this.itemWidth),this.rowsInView=Math.ceil(this.containerHeight/this.itemHeight)),this.totalRows=Math.ceil(n/this.itemsPerRow),this.itemsPerPage=Math.max(this.optItemsPerPage,this.rowsInView*this.itemsPerRow),this.totalSize=this.totalRows*this.itemSize,this.totalSizeSentinel.style.transform=`${this.translateProp}(${this.totalSize}px)`,this.maxStartIndex=Math.max(this.data.length-this.itemsPerPage,0),this.half_w=this.containerWidth/2,this.half_h=this.containerHeight/2,this.boundingClientRect=this.container.getBoundingClientRect(),this.invalidateScrollIndex?(console.log("this.invalidateScrollIndex ",this.invalidateScrollIndex,this.itemsPerRow,this.containerSize),this.isFullSize||(this.invalidateScrollIndex=Math.round(this.invalidateScrollIndex/this.itemsPerRow)),this.container[this.scrollProp]=this.invalidateScrollIndex*this.itemSize,this.startIndex=Math.floor(this.container[this.scrollProp]/this.itemSize)*this.itemsPerRow,this.invalidateScrollIndex=0,this.updateDimensions(!0)):e?this.forceRenderItems():this.scrollHandler()},scrollHandler(){this.scrollAnimationFrame&&cancelAnimationFrame(this.scrollAnimationFrame),this.scrollAnimationFrame=requestAnimationFrame(()=>this.updateScroll()),this.scrollTimeout=setTimeout(()=>{this.updateScroll()},100)},updateScroll(){const e=this.container[this.scrollProp],t=e>this.lastScrollPos?"increase":"decrease";this.lastScrollPos=e;const n=Math.floor(e/this.itemSize)*this.itemsPerRow;if(t==="increase"&&this.useDataFetching&&!this.isFetching&&this.params.cursor&&n>=this.maxStartIndex){this.isFetching=!0,this.fetchUpdateData();return}this.startIndex!==n&&(this.startIndex=n,this.renderItems(t))},clickHandler(e){const{target:t,currentTarget:n}=e,s=t.closest(".item.card").dataset.index,i=this.data[s];console.log(i)},changeHandler(e){},wheelHandler(e){if(!e.target.closest(".full .item-info"))if(!this.isFullSize||!this.isZoomMode){e.preventDefault();const t=Math.sign(e.deltaY);this.scrollDelta+=t,this.useSmoothScrolling(300)}else{const t=-Math.sign(e.deltaY)*.5,n=e.clientX-this.boundingClientRect.left,s=e.clientY-this.boundingClientRect.top;t<0?this.zoomOut(e,n,s):this.zoomIn(e,n,s)}},setupEventListeners(){this.container.addEventListener("scroll",this.throttle(this.scrollHandler.bind(this),100),{passive:!0}),this.container.addEventListener("click",this.clickHandler.bind(this)),this.container.addEventListener("change",this.changeHandler.bind(this)),this.container.addEventListener("wheel",this.wheelHandler.bind(this),{passive:!1}),this.container.tabIndex=-1,this.container.addEventListener("keydown",this.keyPressHandler.bind(this)),this.container.addEventListener("click",()=>this.container.focus()),this.panel=this.itemsWrapper,this.panel.addEventListener("pointerdown",this.pointerDown.bind(this),{passive:!1}),this.panel.addEventListener("pointermove",this.throttle(this.pointerMove.bind(this),16),{passive:!1}),this.panel.addEventListener("pointerup",this.pointerUp.bind(this),{passive:!1}),this.panel.addEventListener("pointercancel",this.pointerUp.bind(this),{passive:!1}),this.panel.addEventListener("pointerleave",this.pointerUp.bind(this),{passive:!1}),this.isMouseDevice=!1,window.addEventListener("mousemove",()=>{this.isMouseDevice=!0},{once:!0})},useSmoothScrolling(e=200){if(this.smoothScrolling){const t=this.container[this.scrollProp]+this.scrollDelta*this.itemSize,n=Math.round(t/this.itemSize)*this.itemSize;this.smoothScroll(n,e)}else this.container[this.scrollProp]+=this.scrollDelta*this.itemSize,this.scrollDelta=0},smoothScroll(e,t){const n=this.container[this.scrollProp],s=e-n;let i=null,o;const a=l=>{i===null&&(i=l);const r=l-i,u=Math.min(r/t,1),d=1-Math.pow(1-u,3);this.container[this.scrollProp]=n+s*d,u<1?o=requestAnimationFrame(a):(this.scrollDelta=0,this.container[this.scrollProp]=e,o=null)};o&&cancelAnimationFrame(o),o=requestAnimationFrame(a)},setupResizeObserver(){new ResizeObserver(()=>{this.resizeTimer&&clearTimeout(this.resizeTimer),this.invalidateScrollIndex||(this.invalidateScrollIndex=this.startIndex),this.resizeTimer=setTimeout(()=>{this.updateDimensions(!0)},100)}).observe(this.container)},keyPressHandler(e){switch(e.key){case"ArrowDown":this.scrollBy(1);break;case"ArrowUp":this.scrollBy(-1);break;case"Home":this.scrollToStart();break;case"End":this.scrollToEnd();break}},scrollBy(e){this.scrollDelta+=e,this.useSmoothScrolling(0)},scrollToStart(){this.startIndex=0,this.container[this.scrollProp]=0},scrollToEnd(){this.startIndex=Math.max(0,this.data.length-this.itemsPerPage),this.container[this.scrollProp]=this.startIndex*this.itemSize},scrollToId(e){const t=this.originalData.findIndex(n=>n.id===e);console.warn(`Item with Index ${t} clicked.`),t!==-1?(this.container.classList.remove("visible"),this.container[this.scrollProp]=0,this.invalidateScrollIndex=t,setTimeout(()=>{this.updateDimensions(),this.container.classList.add("visible")},200)):console.warn(`Item with ID ${e} not found in loaded data object.`)},scrollToIndex(e){this.container.classList.remove("visible"),this.container[this.scrollProp]=0,this.invalidateScrollIndex=e||0,setTimeout(()=>{this.updateDimensions(),this.container.classList.add("visible")},200)},debounce(e,t=1e3){return(function(...n){const s=this,i=typeof n[n.length-1]=="number"?n.pop():t,o=()=>{this.timeout=null,e.apply(s,n)};clearTimeout(this.timeout),this.timeout=setTimeout(o,i)}).bind(this)},throttle(e,t){let n,s,i;return function(){const o=this;i=arguments;const a=Date.now();s?(clearTimeout(n),n=setTimeout(function(){a-s>=t&&(e.apply(o,i),s=a)},t-(a-s))):(e.apply(o,i),s=a)}},setNextCursor(e){e&&this.data.length>0?(this.params.cursor=e,this.params.page=Math.floor(this.data.length/this.params.limit)+1||1):this.params.cursor&&delete this.params.cursor,this.params.limit&&this.data.length>0?this.params.page=Math.floor(this.data.length/this.params.limit)+1:delete this.params.page},getValueByPath(e,t){return t?t.split(".").reduce((s,i)=>{if(s!=null)return s[i]},e):e},setData(e){this.startIndex=0,this.container[this.scrollProp]=0,this.originalData=e,this.data=this.originalData,this.initialize()},appendData(e){this.originalData.push(...e),this.data=this.originalData,this.isFetching=!1,this.updateDimensions(!0)},updateDataByIndex(e,t){const n=this.originalData[t];for(const[s,i]of Object.entries(e))n[s]=i;this.originalData[t]=n,this.data=this.originalData,this.forceRenderItems()},updateDataById(e,t){const n=this.originalData.find(s=>s.id===t);if(n){for(const[s,i]of Object.entries(e))n[s]=i;this.data=this.originalData,this.forceRenderItems()}else console.warn(`Item with ID ${t} not found in loaded data object.`)},removeDataById(e){const t=this.originalData.findIndex(n=>n.id===e);t!==-1?(this.originalData.splice(t,1),this.data=this.originalData,this.total-=1,this.updateDimensions(!0)):console.warn(`Item with ID ${e} not found in loaded data object.`)},setSelectedItems(e){this.selected=e,this.forceRenderItems()},fetchData(e){return new Promise((t,n)=>{const s=new XMLHttpRequest;let i=this.apiUrl;if(this.method.toUpperCase()==="GET"&&this.params){const o=new URLSearchParams;Object.keys(this.params).forEach(a=>{const l=this.params[a];Array.isArray(l)?l.forEach(r=>o.append(a,r)):o.append(a,l)}),i+="?"+o.toString()}s.open(this.method,i,!0),s.setRequestHeader("Accept","application/json"),s.onprogress=function(o){if(o.lengthComputable){const a=parseInt(o.loaded/o.total*100);e(a)}},s.onload=function(){if(s.status===200){const o=JSON.parse(s.responseText);t(o)}else n(s.status)},s.onerror=function(){n(s.status)},this.method.toUpperCase()==="POST"?(s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(this.params))):s.send()})},async fetchUpdateData(e=!1){var n;this.showLoadingIndicator();const t=await this.fetchData(s=>this.updateLoadingIndicator(s));if(t){this.total=t.total;const s=this.getValueByPath(t,this.keys.dataPath)||t;e?this.setData(s):this.appendData(s),this.setNextCursor(((n=t.metadata)==null?void 0:n.nextCursor)||t.nextCursor)}else console.error(`Error fetching data: ${error}`);this.hideLoadingIndicator()},async updateParamsAndFetch(e,t=1e3){Object.assign(this.params,e),Object.keys(this.params).forEach(s=>{this.params[s]||delete this.params[s]}),this.startIndex=0,delete this.params.cursor,this.originalData=[],this.data=this.originalData,this.debounce(this.fetchUpdateData.bind(this,!0),t)()},showLoadingIndicator(){this.loadingIndicator||(this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="loading-indicator",this.container.parentElement.appendChild(this.loadingIndicator),this.hideLoadingIndicator(),this.isFetching=!1),this.loadingIndicator.innerHTML="Loading... 0%",this.loadingIndicator.style.display="flex"},updateLoadingIndicator(e){this.loadingIndicator&&(this.loadingIndicator.innerHTML=`Loading... ${e}%`)},hideLoadingIndicator(){this.loadingIndicator&&(this.loadingIndicator.style.display="none")},showDetail(){this.detail.classList.remove("hidden")},hideDetail(){this.detail&&this.detail.classList.add("hidden")},filterItems(e,t={}){this.startIndex=0,this.data=this.originalData.filter(n=>{let s=!0;e&&(s=s&&n[this.keys.title].toLowerCase().includes(e.toLowerCase()));for(const[i,o]of Object.entries(t))if(n[i]!==void 0&&o!==void 0)if(Array.isArray(n[i])){const a=n[i];s=s&&a.some(l=>typeof l=="string"&&l.toLowerCase().includes(o.toLowerCase()))}else typeof n[i]=="string"&&(s=s&&n[i].toLowerCase().includes(o.toLowerCase()));return s}),this.updateDimensions()},sortItems(e,t=!1){this.startIndex=0;const n=this,s=[...this.data];function i(o,a){const l=n.getValueByPath(o,e),r=n.getValueByPath(a,e);return!isNaN(l)&&!isNaN(r)?t?r-l:l-r:t?r<l?-1:r>l?1:0:l<r?-1:l>r?1:0}s.sort(i),this.data=s,this.updateDimensions()},resetZoom(){this.zoom_scale=1,this.x=this.y=0,this.updateZoom()},zoomIn(e,t,n){this.centeredZoom(1/.65,t,n)},zoomOut(e,t,n){this.centeredZoom(.65,t,n)},getRelativePointers(e){const{boundingClientRect:t}=this,[n,s]=e;return{x1:n.x-t.left,y1:n.y-t.top,x2:s.x-t.left,y2:s.y-t.top}},centerOfPointers(e){const{x1:t,y1:n,x2:s,y2:i}=this.getRelativePointers(e),o=(t+s)/2,a=(n+i)/2;return[o,a]},distance(e){if(e.length<2)return 0;const t=e[0].x-e[1].x,n=e[0].y-e[1].y;return Math.sqrt(t*t+n*n)},scalePointers(e){if(e.length<2)return 0;const t=this.distance(e),n=this.previousDistance||0;if(n>0){const s=t/n,i=this.centerOfPointers(e);this.centeredZoom(s,i[0],i[1])}this.previousDistance=t},centeredZoom(e,t,n){const{zoom_scale:s,x:i,y:o,half_w:a,half_h:l}=this;let r=s*e;if(r<=1){this.resetZoom();return}else if(r>50)return;n?(this.x=t-(t-i-a)*e-a,this.y=n-(n-o-l)*e-l):(this.x*=e,this.y*=e),this.zoom_scale=r,this.updateZoom()},updateZoom(){this.zoomTarget&&(this.zoomTarget.style.transform=`translate(${this.x}px, ${this.y}px) scale(${this.zoom_scale})`)},debounceDoubleTap(e){const t=Date.now();this.lastTapTime&&t-this.lastTapTime<300&&(this.isZoomMode=!this.isZoomMode,this.isZoomMode?(this.zoomTarget=e.target.closest(".item-img"),this.zoom_scale=1.2,this.updateZoom()):(this.activePointers={},this.resetZoom())),this.lastTapTime=t},pointerDown(e){e.target.tagName.toLowerCase()!=="select"&&e.preventDefault(),this.dragged=!1,this.startX=e.pageX,this.startY=e.pageY;const{isFullSize:t,isMouseDevice:n,activePointers:s}=this;s[e.pointerId]={x:e.pageX,y:e.pageY};const i=Object.keys(s).length;if(i>2)return;t||(this.isZoomMode=!1),t&&i===1&&this.debounceDoubleTap(e);const o=this.isZoomMode;console.log(`isZoomMode: ${o}`),(!o&&t||!o&&n)&&i===1&&(this.isDragging=!0,this.start=e[this.client],this.scrollStart=this.container[this.scrollProp],this.container.style.cursor="grabbing")},pointerMove(e){e.preventDefault(),this.dragged=!0;const{isZoomMode:t,isFullSize:n,isMouseDevice:s,activePointers:i,startX:o,startY:a,start:l,scrollProp:r,scrollStart:u}=this;if(i[e.pointerId]){i[e.pointerId]={x:e.pageX,y:e.pageY};const d=Object.keys(i).length;if(t){if(d>2)return;if(d===2)this.scalePointers(Object.values(i));else if(d===1){const m=e.pageX-o,g=e.pageY-a;this.startX=e.pageX,this.startY=e.pageY,this.x+=m,this.y+=g,requestAnimationFrame(()=>{this.updateZoom()})}}else if(!t&&n||!t&&s){if(!this.isDragging||d>1)return;const m=l-e[this.client],g=Math.sign(m);g!==0&&(this.scrollDelta=g),requestAnimationFrame(()=>{this.container[r]=u+m})}}},pointerUp(e){e.preventDefault(),this.dragged=!1;const{isZoomMode:t,isFullSize:n,isMouseDevice:s,activePointers:i}=this;if(delete i[e.pointerId],Object.keys(i).length<2&&(this.previousDistance=0),!t&&n||!t&&s){if(this.isDragging=!1,this.scrollDelta==0)return;this.container.style.cursor="grab",this.useSmoothScrolling(300)}}});/*! @license DOMPurify 3.2.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.3/LICENSE */const{entries:rs,setPrototypeOf:Un,isFrozen:yi,getPrototypeOf:vi,getOwnPropertyDescriptor:Si}=Object;let{freeze:Te,seal:Ne,create:ls}=Object,{apply:dn,construct:un}=typeof Reflect<"u"&&Reflect;Te||(Te=function(t){return t});Ne||(Ne=function(t){return t});dn||(dn=function(t,n,s){return t.apply(n,s)});un||(un=function(t,n){return new t(...n)});const kt=Ie(Array.prototype.forEach),qn=Ie(Array.prototype.pop),ut=Ie(Array.prototype.push),$t=Ie(String.prototype.toLowerCase),en=Ie(String.prototype.toString),Hn=Ie(String.prototype.match),mt=Ie(String.prototype.replace),wi=Ie(String.prototype.indexOf),Ei=Ie(String.prototype.trim),Re=Ie(Object.prototype.hasOwnProperty),xe=Ie(RegExp.prototype.test),pt=xi(TypeError);function Ie(e){return function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return dn(e,t,s)}}function xi(e){return function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return un(e,n)}}function X(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:$t;Un&&Un(e,null);let s=t.length;for(;s--;){let i=t[s];if(typeof i=="string"){const o=n(i);o!==i&&(yi(t)||(t[s]=o),i=o)}e[i]=!0}return e}function Ti(e){for(let t=0;t<e.length;t++)Re(e,t)||(e[t]=null);return e}function Ke(e){const t=ls(null);for(const[n,s]of rs(e))Re(e,n)&&(Array.isArray(s)?t[n]=Ti(s):s&&typeof s=="object"&&s.constructor===Object?t[n]=Ke(s):t[n]=s);return t}function ft(e,t){for(;e!==null;){const s=Si(e,t);if(s){if(s.get)return Ie(s.get);if(typeof s.value=="function")return Ie(s.value)}e=vi(e)}function n(){return null}return n}const Bn=Te(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),tn=Te(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),nn=Te(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Li=Te(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),sn=Te(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ci=Te(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),jn=Te(["#text"]),Wn=Te(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),on=Te(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Gn=Te(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Ot=Te(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ai=Ne(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ii=Ne(/<%[\w\W]*|[\w\W]*%>/gm),Pi=Ne(/\$\{[\w\W]*}/gm),Ni=Ne(/^data-[\-\w.\u00B7-\uFFFF]+$/),ki=Ne(/^aria-[\-\w]+$/),cs=Ne(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Oi=Ne(/^(?:\w+script|data):/i),Mi=Ne(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ds=Ne(/^html$/i),$i=Ne(/^[a-z][.\w]*(-[.\w]+)+$/i);var Vn=Object.freeze({__proto__:null,ARIA_ATTR:ki,ATTR_WHITESPACE:Mi,CUSTOM_ELEMENT:$i,DATA_ATTR:Ni,DOCTYPE_NAME:ds,ERB_EXPR:Ii,IS_ALLOWED_URI:cs,IS_SCRIPT_OR_DATA:Oi,MUSTACHE_EXPR:Ai,TMPLIT_EXPR:Pi});const ht={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Ri=function(){return typeof window>"u"?null:window},Di=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let s=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(s=n.getAttribute(i));const o="dompurify"+(s?"#"+s:"");try{return t.createPolicy(o,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Xn=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function us(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ri();const t=D=>us(D);if(t.version="3.2.3",t.removed=[],!e||!e.document||e.document.nodeType!==ht.document)return t.isSupported=!1,t;let{document:n}=e;const s=n,i=s.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:l,Element:r,NodeFilter:u,NamedNodeMap:d=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:m,DOMParser:g,trustedTypes:E}=e,w=r.prototype,q=ft(w,"cloneNode"),I=ft(w,"remove"),M=ft(w,"nextSibling"),f=ft(w,"childNodes"),y=ft(w,"parentNode");if(typeof a=="function"){const D=n.createElement("template");D.content&&D.content.ownerDocument&&(n=D.content.ownerDocument)}let h,v="";const{implementation:k,createNodeIterator:W,createDocumentFragment:ne,getElementsByTagName:H}=n,{importNode:A}=s;let p=Xn();t.isSupported=typeof rs=="function"&&typeof y=="function"&&k&&k.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:C,ERB_EXPR:$,TMPLIT_EXPR:R,DATA_ATTR:b,ARIA_ATTR:S,IS_SCRIPT_OR_DATA:z,ATTR_WHITESPACE:V,CUSTOM_ELEMENT:J}=Vn;let{IS_ALLOWED_URI:se}=Vn,F=null;const ie=X({},[...Bn,...tn,...nn,...sn,...jn]);let U=null;const K=X({},[...Wn,...on,...Gn,...Ot]);let j=Object.seal(ls(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ce=null,me=null,x=!0,_=!0,T=!1,N=!0,Z=!1,oe=!0,Q=!1,le=!1,he=!1,pe=!1,Ce=!1,be=!1,Ze=!0,ee=!1;const P="user-content-";let B=!0,te=!1,ae={},ye=null;const De=X({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Qe=null;const bn=X({},["audio","video","img","source","image","track"]);let qt=null;const yn=X({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),St="http://www.w3.org/1998/Math/MathML",wt="http://www.w3.org/2000/svg",Be="http://www.w3.org/1999/xhtml";let et=Be,Ht=!1,Bt=null;const fs=X({},[St,wt,Be],en);let Et=X({},["mi","mo","mn","ms","mtext"]),xt=X({},["annotation-xml"]);const hs=X({},["title","style","font","a","script"]);let rt=null;const gs=["application/xhtml+xml","text/html"],_s="text/html";let fe=null,tt=null;const bs=n.createElement("form"),vn=function(c){return c instanceof RegExp||c instanceof Function},jt=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(tt&&tt===c)){if((!c||typeof c!="object")&&(c={}),c=Ke(c),rt=gs.indexOf(c.PARSER_MEDIA_TYPE)===-1?_s:c.PARSER_MEDIA_TYPE,fe=rt==="application/xhtml+xml"?en:$t,F=Re(c,"ALLOWED_TAGS")?X({},c.ALLOWED_TAGS,fe):ie,U=Re(c,"ALLOWED_ATTR")?X({},c.ALLOWED_ATTR,fe):K,Bt=Re(c,"ALLOWED_NAMESPACES")?X({},c.ALLOWED_NAMESPACES,en):fs,qt=Re(c,"ADD_URI_SAFE_ATTR")?X(Ke(yn),c.ADD_URI_SAFE_ATTR,fe):yn,Qe=Re(c,"ADD_DATA_URI_TAGS")?X(Ke(bn),c.ADD_DATA_URI_TAGS,fe):bn,ye=Re(c,"FORBID_CONTENTS")?X({},c.FORBID_CONTENTS,fe):De,ce=Re(c,"FORBID_TAGS")?X({},c.FORBID_TAGS,fe):{},me=Re(c,"FORBID_ATTR")?X({},c.FORBID_ATTR,fe):{},ae=Re(c,"USE_PROFILES")?c.USE_PROFILES:!1,x=c.ALLOW_ARIA_ATTR!==!1,_=c.ALLOW_DATA_ATTR!==!1,T=c.ALLOW_UNKNOWN_PROTOCOLS||!1,N=c.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Z=c.SAFE_FOR_TEMPLATES||!1,oe=c.SAFE_FOR_XML!==!1,Q=c.WHOLE_DOCUMENT||!1,pe=c.RETURN_DOM||!1,Ce=c.RETURN_DOM_FRAGMENT||!1,be=c.RETURN_TRUSTED_TYPE||!1,he=c.FORCE_BODY||!1,Ze=c.SANITIZE_DOM!==!1,ee=c.SANITIZE_NAMED_PROPS||!1,B=c.KEEP_CONTENT!==!1,te=c.IN_PLACE||!1,se=c.ALLOWED_URI_REGEXP||cs,et=c.NAMESPACE||Be,Et=c.MATHML_TEXT_INTEGRATION_POINTS||Et,xt=c.HTML_INTEGRATION_POINTS||xt,j=c.CUSTOM_ELEMENT_HANDLING||{},c.CUSTOM_ELEMENT_HANDLING&&vn(c.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(j.tagNameCheck=c.CUSTOM_ELEMENT_HANDLING.tagNameCheck),c.CUSTOM_ELEMENT_HANDLING&&vn(c.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(j.attributeNameCheck=c.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),c.CUSTOM_ELEMENT_HANDLING&&typeof c.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(j.allowCustomizedBuiltInElements=c.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Z&&(_=!1),Ce&&(pe=!0),ae&&(F=X({},jn),U=[],ae.html===!0&&(X(F,Bn),X(U,Wn)),ae.svg===!0&&(X(F,tn),X(U,on),X(U,Ot)),ae.svgFilters===!0&&(X(F,nn),X(U,on),X(U,Ot)),ae.mathMl===!0&&(X(F,sn),X(U,Gn),X(U,Ot))),c.ADD_TAGS&&(F===ie&&(F=Ke(F)),X(F,c.ADD_TAGS,fe)),c.ADD_ATTR&&(U===K&&(U=Ke(U)),X(U,c.ADD_ATTR,fe)),c.ADD_URI_SAFE_ATTR&&X(qt,c.ADD_URI_SAFE_ATTR,fe),c.FORBID_CONTENTS&&(ye===De&&(ye=Ke(ye)),X(ye,c.FORBID_CONTENTS,fe)),B&&(F["#text"]=!0),Q&&X(F,["html","head","body"]),F.table&&(X(F,["tbody"]),delete ce.tbody),c.TRUSTED_TYPES_POLICY){if(typeof c.TRUSTED_TYPES_POLICY.createHTML!="function")throw pt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof c.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw pt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');h=c.TRUSTED_TYPES_POLICY,v=h.createHTML("")}else h===void 0&&(h=Di(E,i)),h!==null&&typeof v=="string"&&(v=h.createHTML(""));Te&&Te(c),tt=c}},Sn=X({},[...tn,...nn,...Li]),wn=X({},[...sn,...Ci]),ys=function(c){let L=y(c);(!L||!L.tagName)&&(L={namespaceURI:et,tagName:"template"});const O=$t(c.tagName),re=$t(L.tagName);return Bt[c.namespaceURI]?c.namespaceURI===wt?L.namespaceURI===Be?O==="svg":L.namespaceURI===St?O==="svg"&&(re==="annotation-xml"||Et[re]):!!Sn[O]:c.namespaceURI===St?L.namespaceURI===Be?O==="math":L.namespaceURI===wt?O==="math"&&xt[re]:!!wn[O]:c.namespaceURI===Be?L.namespaceURI===wt&&!xt[re]||L.namespaceURI===St&&!Et[re]?!1:!wn[O]&&(hs[O]||!Sn[O]):!!(rt==="application/xhtml+xml"&&Bt[c.namespaceURI]):!1},ze=function(c){ut(t.removed,{element:c});try{y(c).removeChild(c)}catch{I(c)}},Tt=function(c,L){try{ut(t.removed,{attribute:L.getAttributeNode(c),from:L})}catch{ut(t.removed,{attribute:null,from:L})}if(L.removeAttribute(c),c==="is")if(pe||Ce)try{ze(L)}catch{}else try{L.setAttribute(c,"")}catch{}},En=function(c){let L=null,O=null;if(he)c="<remove></remove>"+c;else{const ge=Hn(c,/^[\r\n\t ]+/);O=ge&&ge[0]}rt==="application/xhtml+xml"&&et===Be&&(c='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+c+"</body></html>");const re=h?h.createHTML(c):c;if(et===Be)try{L=new g().parseFromString(re,rt)}catch{}if(!L||!L.documentElement){L=k.createDocument(et,"template",null);try{L.documentElement.innerHTML=Ht?v:re}catch{}}const ve=L.body||L.documentElement;return c&&O&&ve.insertBefore(n.createTextNode(O),ve.childNodes[0]||null),et===Be?H.call(L,Q?"html":"body")[0]:Q?L.documentElement:ve},xn=function(c){return W.call(c.ownerDocument||c,c,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Wt=function(c){return c instanceof m&&(typeof c.nodeName!="string"||typeof c.textContent!="string"||typeof c.removeChild!="function"||!(c.attributes instanceof d)||typeof c.removeAttribute!="function"||typeof c.setAttribute!="function"||typeof c.namespaceURI!="string"||typeof c.insertBefore!="function"||typeof c.hasChildNodes!="function")},Tn=function(c){return typeof l=="function"&&c instanceof l};function je(D,c,L){kt(D,O=>{O.call(t,c,L,tt)})}const Ln=function(c){let L=null;if(je(p.beforeSanitizeElements,c,null),Wt(c))return ze(c),!0;const O=fe(c.nodeName);if(je(p.uponSanitizeElement,c,{tagName:O,allowedTags:F}),c.hasChildNodes()&&!Tn(c.firstElementChild)&&xe(/<[/\w]/g,c.innerHTML)&&xe(/<[/\w]/g,c.textContent)||c.nodeType===ht.progressingInstruction||oe&&c.nodeType===ht.comment&&xe(/<[/\w]/g,c.data))return ze(c),!0;if(!F[O]||ce[O]){if(!ce[O]&&An(O)&&(j.tagNameCheck instanceof RegExp&&xe(j.tagNameCheck,O)||j.tagNameCheck instanceof Function&&j.tagNameCheck(O)))return!1;if(B&&!ye[O]){const re=y(c)||c.parentNode,ve=f(c)||c.childNodes;if(ve&&re){const ge=ve.length;for(let Le=ge-1;Le>=0;--Le){const Fe=q(ve[Le],!0);Fe.__removalCount=(c.__removalCount||0)+1,re.insertBefore(Fe,M(c))}}}return ze(c),!0}return c instanceof r&&!ys(c)||(O==="noscript"||O==="noembed"||O==="noframes")&&xe(/<\/no(script|embed|frames)/i,c.innerHTML)?(ze(c),!0):(Z&&c.nodeType===ht.text&&(L=c.textContent,kt([C,$,R],re=>{L=mt(L,re," ")}),c.textContent!==L&&(ut(t.removed,{element:c.cloneNode()}),c.textContent=L)),je(p.afterSanitizeElements,c,null),!1)},Cn=function(c,L,O){if(Ze&&(L==="id"||L==="name")&&(O in n||O in bs))return!1;if(!(_&&!me[L]&&xe(b,L))){if(!(x&&xe(S,L))){if(!U[L]||me[L]){if(!(An(c)&&(j.tagNameCheck instanceof RegExp&&xe(j.tagNameCheck,c)||j.tagNameCheck instanceof Function&&j.tagNameCheck(c))&&(j.attributeNameCheck instanceof RegExp&&xe(j.attributeNameCheck,L)||j.attributeNameCheck instanceof Function&&j.attributeNameCheck(L))||L==="is"&&j.allowCustomizedBuiltInElements&&(j.tagNameCheck instanceof RegExp&&xe(j.tagNameCheck,O)||j.tagNameCheck instanceof Function&&j.tagNameCheck(O))))return!1}else if(!qt[L]){if(!xe(se,mt(O,V,""))){if(!((L==="src"||L==="xlink:href"||L==="href")&&c!=="script"&&wi(O,"data:")===0&&Qe[c])){if(!(T&&!xe(z,mt(O,V,"")))){if(O)return!1}}}}}}return!0},An=function(c){return c!=="annotation-xml"&&Hn(c,J)},In=function(c){je(p.beforeSanitizeAttributes,c,null);const{attributes:L}=c;if(!L||Wt(c))return;const O={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U,forceKeepAttr:void 0};let re=L.length;for(;re--;){const ve=L[re],{name:ge,namespaceURI:Le,value:Fe}=ve,lt=fe(ge);let Ee=ge==="value"?Fe:Ei(Fe);if(O.attrName=lt,O.attrValue=Ee,O.keepAttr=!0,O.forceKeepAttr=void 0,je(p.uponSanitizeAttribute,c,O),Ee=O.attrValue,ee&&(lt==="id"||lt==="name")&&(Tt(ge,c),Ee=P+Ee),oe&&xe(/((--!?|])>)|<\/(style|title)/i,Ee)){Tt(ge,c);continue}if(O.forceKeepAttr||(Tt(ge,c),!O.keepAttr))continue;if(!N&&xe(/\/>/i,Ee)){Tt(ge,c);continue}Z&&kt([C,$,R],Nn=>{Ee=mt(Ee,Nn," ")});const Pn=fe(c.nodeName);if(Cn(Pn,lt,Ee)){if(h&&typeof E=="object"&&typeof E.getAttributeType=="function"&&!Le)switch(E.getAttributeType(Pn,lt)){case"TrustedHTML":{Ee=h.createHTML(Ee);break}case"TrustedScriptURL":{Ee=h.createScriptURL(Ee);break}}try{Le?c.setAttributeNS(Le,ge,Ee):c.setAttribute(ge,Ee),Wt(c)?ze(c):qn(t.removed)}catch{}}}je(p.afterSanitizeAttributes,c,null)},vs=function D(c){let L=null;const O=xn(c);for(je(p.beforeSanitizeShadowDOM,c,null);L=O.nextNode();)je(p.uponSanitizeShadowNode,L,null),Ln(L),In(L),L.content instanceof o&&D(L.content);je(p.afterSanitizeShadowDOM,c,null)};return t.sanitize=function(D){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=null,O=null,re=null,ve=null;if(Ht=!D,Ht&&(D="<!-->"),typeof D!="string"&&!Tn(D))if(typeof D.toString=="function"){if(D=D.toString(),typeof D!="string")throw pt("dirty is not a string, aborting")}else throw pt("toString is not a function");if(!t.isSupported)return D;if(le||jt(c),t.removed=[],typeof D=="string"&&(te=!1),te){if(D.nodeName){const Fe=fe(D.nodeName);if(!F[Fe]||ce[Fe])throw pt("root node is forbidden and cannot be sanitized in-place")}}else if(D instanceof l)L=En("<!---->"),O=L.ownerDocument.importNode(D,!0),O.nodeType===ht.element&&O.nodeName==="BODY"||O.nodeName==="HTML"?L=O:L.appendChild(O);else{if(!pe&&!Z&&!Q&&D.indexOf("<")===-1)return h&&be?h.createHTML(D):D;if(L=En(D),!L)return pe?null:be?v:""}L&&he&&ze(L.firstChild);const ge=xn(te?D:L);for(;re=ge.nextNode();)Ln(re),In(re),re.content instanceof o&&vs(re.content);if(te)return D;if(pe){if(Ce)for(ve=ne.call(L.ownerDocument);L.firstChild;)ve.appendChild(L.firstChild);else ve=L;return(U.shadowroot||U.shadowrootmode)&&(ve=A.call(s,ve,!0)),ve}let Le=Q?L.outerHTML:L.innerHTML;return Q&&F["!doctype"]&&L.ownerDocument&&L.ownerDocument.doctype&&L.ownerDocument.doctype.name&&xe(ds,L.ownerDocument.doctype.name)&&(Le="<!DOCTYPE "+L.ownerDocument.doctype.name+`>
`+Le),Z&&kt([C,$,R],Fe=>{Le=mt(Le,Fe," ")}),h&&be?h.createHTML(Le):Le},t.setConfig=function(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};jt(D),le=!0},t.clearConfig=function(){tt=null,le=!1},t.isValidAttribute=function(D,c,L){tt||jt({});const O=fe(D),re=fe(c);return Cn(O,re,L)},t.addHook=function(D,c){typeof c=="function"&&ut(p[D],c)},t.removeHook=function(D){return qn(p[D])},t.removeHooks=function(D){p[D]=[]},t.removeAllHooks=function(){p=Xn()},t}var ms=us();function ps(e,t,n,s){const i=document.createElement("div");i.className="item card",n!=null&&n.has(e.name)?i.classList.add("active"):i.classList.remove("active");const o=document.createElement("button");o.className="icon-grid-size fullsize-button card-button";const a=document.createElement("button");a.className="icon-full-screen fullScreen-button card-button";const l=document.createElement("button");l.className="icon-tile tile-button card-button";const r=document.createElement("button");r.className="icon-info info-button card-button";const u=document.createElement("button");u.className="edit-meta edit-button card-button";const d=document.createElement("button");d.className="copy-path copy-path-button card-button";const m=document.createElement("button");m.className="icon-delete delete-button card-button";const g=document.createElement("button");g.className="icon-send-params send-params-button card-button";const E=document.createElement("div");E.className="item-info";const w=document.createElement("span");w.className="item-info-title",w.textContent=e.name;const q=document.createElement("div");q.className="item-info-description";const I=document.createElement("p");I.textContent=e.prompt;const M=document.createElement("p");M.textContent=e.negative;const f=document.createElement("p");f.textContent=e.tags;const y=document.createElement("p");y.textContent=e.extra,q.appendChild(I),q.appendChild(M),q.appendChild(f),q.appendChild(y),E.appendChild(w),E.appendChild(q);const h=document.createElement("div");h.className="item-actions-row";const v=document.createElement("div");v.className="item-actions";const k=document.createElement("div");k.className="item-actions-top";const W=document.createElement("div");W.className="item-spacer",k.appendChild(g),k.appendChild(W),k.appendChild(o),k.appendChild(a),v.appendChild(l),v.appendChild(r),v.appendChild(d),v.appendChild(u),v.appendChild(m),h.appendChild(k),h.appendChild(v),i.appendChild(h);const ne=e[t],H=e.timestamp||"";if(ne){const A=document.createElement("div");A.style.backgroundImage=`url('${s}${encodeURIComponent(ne)}${H}')`,A.className="item-img",i.appendChild(A)}return i.appendChild(E),i}function zi(e,t,n,s){const i=document.createElement("div");i.className="item card",n!=null&&n.has(e.name)?i.classList.add("active"):i.classList.remove("active");const o=document.createElement("button");o.className="icon-grid-size fullsize-button card-button";const a=document.createElement("button");a.className="icon-full-screen fullScreen-button card-button";const l=document.createElement("button");l.className="icon-tile tile-button card-button";const r=document.createElement("button");r.className="icon-info info-button card-button";const u=document.createElement("button");u.className="edit-meta edit-button card-button";const d=document.createElement("button");d.className="copy-path copy-path-button card-button";const m=document.createElement("button");m.className="icon-send-params send-params-button card-button";const g=document.createElement("div");g.className="item-info";const E=document.createElement("span");E.className="item-info-title",E.textContent=e.name;const w=document.createElement("div");if(w.className="item-info-description",e.activation_text){const k=document.createElement("p");k.textContent=e.activation_text;const W=document.createElement("p");W.textContent=e.negative_prompt,w.appendChild(k),w.appendChild(W)}const q=document.createElement("p");q.textContent=e.tags,w.appendChild(q),g.appendChild(E),g.appendChild(w);const I=document.createElement("div");I.className="item-actions-row";const M=document.createElement("div");M.className="item-actions";const f=document.createElement("div");f.className="item-actions-top";const y=document.createElement("div");if(y.className="item-spacer",f.appendChild(m),f.appendChild(y),f.appendChild(o),f.appendChild(a),M.appendChild(r),M.appendChild(d),M.appendChild(u),e.metadata_exists){const k=document.createElement("button");k.className="show-meta metadata-button card-button",M.appendChild(k)}I.appendChild(f),I.appendChild(M),i.appendChild(I);const h=e[t],v=e.timestamp||"";if(h){const k=document.createElement("div");k.style.backgroundImage=`url('${s}${encodeURIComponent(h)}${v}')`,k.className="item-img",i.appendChild(k)}return i.appendChild(g),i}const Fi=["clipSkip","cfgScale","sampler","steps","seed","Size"];function Ui(e,t){const n=document.createElement("div");n.className="item card";const s=document.createElement("button");s.className="icon-grid-size fullsize-button card-button";const i=document.createElement("button");i.className="icon-full-screen fullScreen-button card-button";const o=document.createElement("button");o.className="icon-tile tile-button card-button";const a=document.createElement("button");a.className="icon-info info-button card-button";const l=document.createElement("button");l.className="icon-stylez civit-add2styles-button card-button";const r=document.createElement("button");r.className="icon-link civit-link-button card-button";const u=document.createElement("button");u.className="icon-send-params send-params-button card-button";const d=document.createElement("div");d.className="item-info";const m=document.createElement("button");m.className="item-info-title",m.textContent=e.username;const g=document.createElement("div");g.className="item-info-description";const E=[];e.baseModel&&E.push(`baseModel: ${e.baseModel}`);const w=e.meta;if(w){if(w.prompt){const v=document.createElement("p");v.textContent="Prompt: "+w.prompt,g.appendChild(v)}if(w.negativePrompt){const v=document.createElement("p");v.textContent="Negative prompt: "+w.negativePrompt,g.appendChild(v)}Fi.forEach(v=>{w[v]!==void 0&&E.push(`${v}: ${w[v]}`)});const h=document.createElement("p");h.textContent=E.join(", "),g.appendChild(h),w.civitaiResources&&w.civitaiResources.forEach(v=>{const k=v.type?v.type:"Unknown Type",W=v.weight?v.weight:"",ne=v.name?v.name:"",H=v.modelVersionId?v.modelVersionId:null,A=v.modelVersionName;if(H){const p=document.createElement("p");p.textContent=`${k}: ${W} ${ne}`;const C=document.createElement("a");C.textContent=`${A||"Model Id: "+H}`,C.href=`https://civitai.com/api/v1/models/${H}`,C.target="_blank",p.appendChild(C),g.appendChild(p)}})}d.appendChild(m),d.appendChild(g);const q=document.createElement("div");q.className="item-actions-row";const I=document.createElement("div");I.className="item-actions";const M=document.createElement("div");M.className="item-actions-top";const f=document.createElement("div");f.className="item-spacer",M.appendChild(u),M.appendChild(f),M.appendChild(s),M.appendChild(i),I.appendChild(a),I.appendChild(r),I.appendChild(l),q.appendChild(M),q.appendChild(I),n.appendChild(q);let y=e.url;if(y){if(t=="thumbnail"){const v=y.split("width="),k=v[1].split("/")[1];y=v[0]+"width=320/"+k}const h=document.createElement("div");h.style.backgroundImage=`url('${y}')`,h.className="item-img",n.appendChild(h)}return n.appendChild(d),n}function qi(e,t){var M,f;const n=document.createElement("div");n.className="item card";const s=document.createElement("button");s.className="icon-grid-size fullsize-button card-button";const i=document.createElement("button");i.className="icon-full-screen fullScreen-button card-button";const o=document.createElement("button");o.className="icon-tile tile-button card-button";const a=document.createElement("button");a.className="icon-info info-button card-button";const l=document.createElement("button");l.className="icon-link civit-link-button card-button";const r=document.createElement("button");r.className="icon-send-params send-params-button card-button";const u=document.createElement("div");u.className="item-info";const d=document.createElement("span");d.className="item-info-title",d.textContent=e.name;const m=document.createElement("span");m.textContent=e.type,m.className=`extra-type ${e.type}`;const g=document.createElement("div");g.innerHTML=ms.sanitize(e.description),g.className="item-info-description",u.appendChild(d),u.appendChild(g);const E=document.createElement("div");E.className="item-actions-row";const w=document.createElement("div");w.className="item-actions";const q=document.createElement("div");q.className="item-spacer",w.appendChild(r),w.appendChild(q),w.appendChild(s),w.appendChild(i),w.appendChild(a),w.appendChild(l),E.appendChild(w),n.appendChild(m),n.appendChild(E);let I=(f=(M=e.modelVersions[0])==null?void 0:M.images[0])==null?void 0:f.url;if(I){{const h=I.split("width="),v=h[1].split("/")[1];I=h[0]+"width=320/"+v}const y=document.createElement("div");y.style.backgroundImage=`url(${encodeURI(I)})`,y.className="item-img",n.appendChild(y)}return n.appendChild(u),n}function Hi(e){const t=e/1024;return t>=1024?`${(t/1024).toFixed(2)} GB`:`${t.toFixed(2)} MB`}function Bi(e,t,n){const s=document.createElement("div");s.className="item card";const i=document.createElement("button");i.className="icon-grid-size fullsize-button card-button";const o=document.createElement("button");o.className="icon-full-screen fullScreen-button card-button";const a=document.createElement("button");a.className="icon-tile tile-button card-button";const l=document.createElement("button");l.className="icon-info info-button card-button";const r=document.createElement("button");r.className="icon-link civit-link-button card-button";const u=document.createElement("button");u.className="icon-send-params send-params-button card-button";const d=document.createElement("div");d.className="item-info";const m=document.createElement("span");m.className="item-info-title",m.textContent=t.name;const g=document.createElement("span");g.textContent=t.type,g.className=`extra-type ${t.type}`;const E=document.createElement("select");E.className="baseModel-select";const w=t.modelVersions;w.forEach((H,A)=>{const p=document.createElement("option");p.value=A,p.textContent=`${H.baseModel} | ${H.name} | ${H.baseModelType}`,A===n&&(p.selected=!0),E.appendChild(p)});const q=w[n].files[0].downloadUrl,I=w[n].files[0].name,M=w[n].files[0].sizeKB,f=document.createElement("a");f.target="_blank",f.setAttribute("data-url",q),f.className="model-sdownload",f.textContent=`${I} - ${Hi(M)}`;let y=w[n].description;n===0&&(y=(t.description||"")+(w[n].description||""));const h=document.createElement("div");h.innerHTML=ms.sanitize(y),h.className="item-info-description",d.appendChild(m),d.appendChild(E),d.appendChild(f);const v=e.url;if(v){const H=document.createElement("a");H.className="download-image-button";const A=v.split(".").pop().split("?")[0],p=`${I.split(".")[0]}.${A}`;H.textContent=`${p}`,H.setAttribute("data-url",v),H.setAttribute("data-filename",p),d.appendChild(H)}d.appendChild(h);const k=document.createElement("div");k.className="item-actions-row";const W=document.createElement("div");W.className="item-actions";const ne=document.createElement("div");if(ne.className="item-spacer",W.appendChild(u),W.appendChild(ne),W.appendChild(i),W.appendChild(o),W.appendChild(l),W.appendChild(r),k.appendChild(W),s.appendChild(g),s.appendChild(k),v){const H=document.createElement("div");H.style.backgroundImage=`url(${v})`,H.className="item-img",s.appendChild(H)}return s.appendChild(d),s}async function ji(){const e=document.querySelector("#civitai_cardholder_images"),t=document.querySelector("#civit_search_images"),n=document.querySelector("#civit_search_images_clear"),s=100,i="/sd_webui_ux/civitai_proxy/images",o={"#civit_nsfw_images":"nsfw","#civit_sort_images":"sort","#civit_period_images":"period","#civit_search_images":"username"},a={limit:s,page:1},l={title:"username",url:"url",dataPath:"items"};let r="thumbnail";const u=new Je(e,[],18,l,i,a),d=vt(o,a,u);u.createItemElement=E=>Ui(E,r);function m(E,w,q){const I=window.UIUX.FOCUS_PROMPT;if(E.classList.contains("copy-path"))navigator.clipboard.writeText(w.filename);else if(E.classList.contains("fullsize-button"))u.scrollToId(w.id),u.isFullSize?(r="thumbnail",u.setFullSize(!1),u.setLayout("vertical"),E.classList.remove("active")):(r="original",u.setFullSize(!0),u.setLayout("vertical"),E.classList.add("active"));else if(E.classList.contains("info-button"))u.setInfo(!u.isInfo);else if(E.classList.contains("fullScreen-button"))u.scrollToId(w.id),u.setFullScreen(!u.isFullScreen);else if(E.classList.contains("send-params-button")){const M=`${w.url}`;ot(M,`#pnginfo_send_${I} button`)}else E.classList.contains("item-info-title")?(t.value=E.textContent,He(t)):E.classList.contains("civit-link-button")?window.open(`https://civitai.com/images/${w.id}`,"_blank"):E.classList.contains("civit-add2styles-button")}u.clickHandler=function(E){if(u.dragged||u.scrollDelta)return;const w=E.target.closest(".item.card"),q=w==null?void 0:w.dataset.id;if(q){const I=this.data.find(M=>M.id.toString()===q);console.log(q,E.target,I),I&&m(E.target,I)}E.preventDefault(),E.stopPropagation()};function g(E){t.value="",He(t)}n.addEventListener("click",g),u.updateParamsAndFetch(d,0)}async function Wi(){const e=document.querySelector("#civitai_cardholder_models"),t=document.querySelector("#civit_search_models"),n=document.querySelector("#civit_search_models_clear"),s=100,i="/sd_webui_ux/civitai_proxy/models",o={"#civit_nsfw_models":"nsfw","#civit_type_models":"types","#civit_sort_models":"sort","#civit_period_models":"period","#civit_search_models":"query"},a={limit:s,page:1},l={title:"username",url:"url",dataPath:"items"};let r,u=0;const d=new Je(e,[],18,l,i,a),m=vt(o,a,d);function g(f,y,h){const v=window.UIUX.FOCUS_PROMPT;if(f.classList.contains("civit-link-button"))window.open(`https://civitai.com/models/${y.id}`,"_blank");else if(f.classList.contains("fullsize-button"))d.showDetail(),r=y,u=0,w.setData(y.modelVersions[u].images),w.setFullSize(!0),w.setLayout("vertical"),w.scrollToStart();else if(f.classList.contains("info-button"))d.setInfo(!d.isInfo);else if(f.classList.contains("fullScreen-button"))d.scrollToId(y.id),d.setFullScreen(!d.isFullScreen);else if(f.classList.contains("send-params-button")){const k=`${y.modelVersions[0].images[0].url}`;ot(k,`#pnginfo_send_${v} button`)}else f.classList.contains("item-info-title")&&(t.value=f.textContent,He(t))}d.createItemElement=f=>qi(f),d.clickHandler=function(f){if(d.dragged||d.scrollDelta)return;const y=f.target.closest(".item.card"),h=y==null?void 0:y.dataset.id;if(h){const v=this.data.find(k=>k.id.toString()===h);console.log(h,f.target,v),v&&g(f.target,v)}f.preventDefault(),f.stopPropagation()};const E=e.parentElement.querySelector(".ae-virtual-detail-content"),w=new Je(E,[],8);w.createItemElement=f=>Bi(f,r,u),w.clickHandler=function(f){if(w.dragged||w.scrollDelta)return;const y=f.target.closest(".item.card"),h=y==null?void 0:y.dataset.id;if(h){const v=this.data.find(k=>k.id.toString()===h);v&&q(f.target,v)}f.preventDefault(),f.stopPropagation()},w.changeHandler=function(f){const y=f.target;y.classList.contains("baseModel-select")&&(u=parseInt(y.value),this.setData(r.modelVersions[u].images))};function q(f,y,h){const v=window.UIUX.FOCUS_PROMPT;if(f.classList.contains("civit-link-button"))window.open(`https://civitai.com/models/${r.id}?modelVersionId=${r.modelVersions[u].id}`,"_blank");else if(f.classList.contains("fullsize-button"))d.hideDetail();else if(f.classList.contains("info-button"))w.setInfo(!w.isInfo);else if(f.classList.contains("fullScreen-button"))w.scrollToId(y.id),w.setFullScreen(!w.isFullScreen);else if(f.classList.contains("send-params-button")){const k=`${y.url}`;ot(k,`#pnginfo_send_${v} button`)}else f.classList.contains("item-info-title")||(f.classList.contains("download-image-button")?I(f.dataset.url,f.dataset.filename):f.classList.contains("model-sdownload")&&I(f.dataset.url))}function I(f,y){const h=document.createElement("a");h.target="_blank",h.href=f,y&&(h.download=y),document.body.appendChild(h),h.click(),document.body.removeChild(h)}function M(f){t.value="",He(t)}n.addEventListener("click",M),d.updateParamsAndFetch(m,0)}function we(e,t,n,s=""){this.container=document.querySelector(e),this.fetchUrl=t,this.tableName=n,this.rootPath=s.replace(/\\/g,"/").toLowerCase(),this.selected}we.prototype.initialize=async function(){this.container.innerHTML="";const e=await this.fetchData(this.rootPath),t=this.buildTree(e),n=this.createTreeView(t);this.container.appendChild(n),this.attachEventListeners(),this.itemMap=e.reduce((s,i)=>(s[i.id]=i,s),{})};we.prototype.updateSelectedItems=function(){var e;this.container.querySelectorAll(".li-file.active").forEach(t=>{t.classList.remove("active")}),(e=this.selected)==null||e.forEach(t=>{const n=this.container.querySelector(`.li-file[data-name="${t}"]`);n&&n.classList.add("active")})};we.prototype.fetchData=async function(e){const n=await(await fetch(`${this.fetchUrl}?table_name=${this.tableName}&path=${encodeURIComponent(e)}`)).json();return this.data=n.data,this.subpaths=n.unique_subpaths,this.subpaths=this.subpaths.map(s=>{const i=s.split(e);return{path:s,relativePath:i[1],basePath:`${i[0]}${e}`}}),console.log(this.subpaths),console.log("tree data length:",this.data.length),n.data};we.prototype.buildTree=function(e){const t={},n=this.rootPath;t[n]={};const s=t[n];return e.forEach(i=>{const o=i.filename.replace(/\\/g,"/").toLowerCase(),a=o.indexOf(n);if(a===-1)return;const r=o.slice(a+n.length).replace(/^\//,"").split("/").filter(Boolean);let u=s;for(let d=0;d<r.length;d++){const m=r[d];u[m]||(d===r.length-1?u[m]=i:u[m]={}),u=u[m]}}),t};we.prototype.createFileItem=function(e,t){const n=document.createElement("li");return n.dataset.name=e[t].name,n.dataset.id=e[t].id,n.innerHTML=`<summary class="tree-file">${e[t].name}</summary>`,n.classList.add("li-file"),n};we.prototype.createFolderItem=function(e,t,n){n+="/"+t,n=n.replace(/\/{2,}/g,"/");const s=document.createElement("li");s.innerHTML=`<summary class="tree-folder caret" data-path="${n}">${t}</summary>`;const i=this.createTreeView(e[t],n);return i.classList.add("nested"),s.appendChild(i),s};we.prototype.createTreeView=function(e,t=""){const n=document.createElement("ul");n.classList.add("tree-view");for(const s in e){let i;typeof e[s]=="object"&&!Array.isArray(e[s])?s.includes(".safetensors")||s.includes(".pt")||s.includes(".png")||s.includes(".jpg")||s.includes(".webp")?i=this.createFileItem(e,s):i=this.createFolderItem(e,s,t):i=this.createFileItem(e,s),n.appendChild(i)}return n};we.prototype.attachEventListeners=function(){this.eventListenerAdded||(this.container.addEventListener("click",async e=>{const t=e.target,n=t.closest("li[data-id]");if(t.tagName==="BUTTON"){const i=n.dataset.id,o=this.getItemProperties(i);this.onFileClicked(t,o)}else if(n){const i=n.dataset.id,o=this.getItemProperties(i);this.onFileClicked(n,o)}else if(t.classList.contains("caret")){t.classList.toggle("caret-down");const i=t.nextElementSibling;i.classList.contains("nested")&&i.classList.toggle("active"),this.onFolderClicked(t,t.getAttribute("data-path"),i.classList.contains("active"))}e.stopPropagation()}),this.eventListenerAdded=!0)};we.prototype.getItemProperties=function(e){return this.itemMap[e]};we.prototype.update=async function(){const e=[];this.container.querySelectorAll(".tree-folder.caret-down").forEach(n=>{e.push(n.dataset.path)});const t=this.container.parentElement.scrollTop;await this.initialize(),e.forEach(n=>{const s=this.container.querySelector(`.tree-folder[data-path="${n}"]`);s&&s.click()}),this.container.parentElement.scrollTop=t,this.attachEventListeners()};we.prototype.updateDataById=function(e,t){const n=this.itemMap[t];if(n)for(const[s,i]of Object.entries(e))n[s]=i;else console.error(`Item with ID ${t} not found.`)};we.prototype.onFolderClicked=function(e,t,n){};we.prototype.onFileClicked=function(e,t){};function _e(e,t,n,s,i="Submit"){this.url=e,this.table_name=t,this.itemData=n,this.container=s,this.submit_label=i,this.form=document.createElement("form"),this.form.setAttribute("id","userMetadataForm"),this.form.classList.add("flexbox","padding","col","shrink")}_e.prototype.formatFileSize=function(e){return typeof e!="number"?"0 bytes":e>=1073741824?(e/1073741824).toFixed(2)+" GB":e>=1048576?(e/1048576).toFixed(2)+" MB":e>=1024?(e/1024).toFixed(2)+" KB":e+" bytes"};_e.prototype.formatDate=function(e){return typeof e!="number"?"":new Date(e*1e3).toLocaleDateString()};_e.prototype.formatFilename=function(e){return typeof e!="string"?"":e.replace(/\\/g,"/").split("/").pop()};_e.prototype.createElement=function(e,t,n,s={}){const i={textarea:{tag:"textarea",attributes:{...s,rows:s.rows||1,textContent:n||""}},select:{tag:"select",attributes:{id:s.id,class:s.class,name:s.name},children:Array.isArray(s.options)?s.options.map(r=>({option:{type:"option",value:r.value,textContent:r.textContent,selected:r.value===s.value}})):[]},option:{tag:"option",attributes:{...s}},input:{tag:"input",attributes:{...s,type:"text",value:n||""}},file:{tag:"input",attributes:{type:"file"}},number:{tag:"input",attributes:{type:"number",value:n}},checkbox:{tag:"input",attributes:{type:"checkbox",checked:n}},radio:{tag:"input",attributes:{type:"radio",checked:n}},slider:{tag:"input",attributes:{type:"range",value:n}},img:{tag:"img",attributes:{src:s.req+n,alt:t,class:"thumbnail-image"}},button:{tag:"button",textContent:n,attributes:{type:"button",id:s.id,class:"ae-button",name:t}},placeholder:{tag:"div",attributes:s},row:{tag:"div",attributes:{id:s.id,class:`flexbox row ${s.class||""}`},children:s.children},col:{tag:"div",attributes:{id:s.id,class:`flexbox col ${s.class||""}`},children:s.children},panel:{tag:"div",attributes:{id:s.id,class:`panel padding ${s.class||""}`},children:s.children},default:{tag:"input",attributes:{type:"text",value:n||""}}},o=i[e]||i.default,a=document.createElement(o.tag);return((r,u)=>{Object.entries(u).forEach(([d,m])=>{typeof d=="string"&&d.trim()!==""?d==="textContent"?r.textContent=m:d==="checked"?r.checked=!!m:d==="selected"?r.selected=!!m:(typeof m=="string"||typeof m=="number")&&r.setAttribute(d,m):console.warn(`Invalid attribute name: ${d}`)})})(a,o.attributes),o.children&&o.children.forEach(r=>{const u=Object.keys(r)[0],d=r[u],m=d.value!==void 0?d.value:this.itemData[u]||"",g=this.createElement(d.type,u,m,d);a.appendChild(g)}),a};_e.prototype.addElementToForm=function(e,t){const n=document.createElement("div");n.classList.add("panel","col","padding"),t.id&&(n.id=t.id);const s=document.createElement("label");s.setAttribute("for",e),s.classList.add("flexbox"),s.textContent=t.label||e.replace("_"," ").toUpperCase();const i=this.createElement(t.type,e,this.itemData[e],t);n.appendChild(s),n.appendChild(i),this.form.appendChild(n)};_e.prototype.createForm=function(e){Object.entries(e).forEach(([i,o])=>{(this.itemData.hasOwnProperty(i)||o.draw==="true")&&this.addElementToForm(i,o)});const t=document.createElement("div");t.classList.add("panel","row","flex-end");const n=document.createElement("button");n.setAttribute("type","submit"),n.textContent=this.submit_label,n.classList.add("ae-submit-button"),t.appendChild(n);const s=document.createElement("button");if(s.setAttribute("type","button"),s.textContent="Cancel",s.classList.add("ae-submit-button","cancel"),t.appendChild(s),this.itemData.id){const i=document.createElement("button");i.setAttribute("type","button"),i.textContent="Delete",i.classList.add("ae-submit-button","delete"),t.appendChild(i)}return this.form.appendChild(t),this.form.addEventListener("submit",i=>this.handleSubmit(i)),this.form};_e.prototype.createValueElement=function(e,t,n,s,i){let o=`?t=${new Date().getTime()}`;i&&i.indexOf("filename=")!==-1&&(o=`&t=${new Date().getTime()}`);const a={filename:{textContent:this.formatFilename(n)},filesize:{textContent:this.formatFileSize(n)},"date-format":{textContent:this.formatDate(n)},img:{tag:"img",attributes:{src:i+n+o,alt:t,class:"thumbnail-image"}},button:{tag:"button",textContent:s||"button",attributes:{class:`ae-button ${t}`,name:t}},default:{textContent:n||""}},l=a[e]||a.default;let r;return l.tag?(r=document.createElement(l.tag),Object.entries(l.attributes).forEach(([u,d])=>{r.setAttribute(u,d)}),l.textContent&&(r.textContent=l.textContent)):(r=document.createElement("span"),r.textContent=l.textContent),r};_e.prototype.createTable=function(e){const t=document.createElement("table");return t.classList.add("non-editable-table","panel"),Object.entries(e).forEach(([n,s])=>{const i=document.createElement("tr"),o=document.createElement("td");o.textContent=n.replace("_"," ").toUpperCase(),i.appendChild(o);const a=document.createElement("td"),l=this.createValueElement(s.type,n,this.itemData[n]);a.appendChild(l),i.appendChild(a),t.appendChild(i)}),t};_e.prototype.createHtmlElement=function(e){const t=document.createElement("div");return t.classList.add("non-editable-div","flexbox","col","shrink"),Object.entries(e).forEach(([n,s])=>{const i=document.createElement("div");if(i.classList.add("panel",n),s.showLabel!==!1){const a=document.createElement("label");a.textContent=n.replace("_"," ").toUpperCase(),i.appendChild(a)}const o=this.createValueElement(s.type,n,this.itemData[n],s.label||"",s.api);i.appendChild(o),t.appendChild(i)}),t};_e.prototype.buildTags=function(e){const t=/[-_\w']+/g;function n(o){return Object.keys(o).reduce((l,r)=>l+r.length,0)/Object.keys(o).length>=16}const s={},i=e.ss_tag_frequency||{};for(const o of Object.values(i))for(const[a,l]of Object.entries(o)){const r=a.trim();s[r]=(s[r]||0)+parseInt(l,10)}if(Object.keys(s).length>0&&n(s)){const o={};for(const[a,l]of Object.entries(s)){const r=a.match(t)||[];for(const u of r)u.length>=3&&(o[u]=(o[u]||0)+l)}return Object.entries(o).sort(([,a],[,l])=>l-a).map(([a,l])=>[a,l])}return Object.entries(s).sort(([,o],[,a])=>a-o).map(([o,a])=>[o,a])};_e.prototype.createTagsElement=function(e,t){const n=this.buildTags(e);if(n.length>0){const s=document.createElement("div");s.classList.add("non-editable-tags","flexbox","shrink");const i=document.createElement("div");if(i.classList.add("panel","flexbox","row","padding"),t){const o=document.createElement("label");o.textContent=t.toUpperCase(),i.appendChild(o)}return Object.entries(n).forEach(o=>{const a=document.createElement("button");a.type="button",a.textContent=o[1][0];const l=document.createElement("span");l.classList.add("tag-num"),l.textContent=o[1][1],a.appendChild(l),i.appendChild(a)}),s.appendChild(i),s}return!1};_e.prototype.afterFormSubmit=function(e,t,n){};_e.prototype.beforeFormSubmit=function(e){return e};_e.prototype.handleSubmit=async function(e){e.preventDefault();const t=new FormData(this.form),n=Object.fromEntries(t.entries());let s=n;s.table_name=this.table_name,s.name=this.itemData.name,s=this.beforeFormSubmit(n);let i;s.file&&(i=s.file,delete s.file);const o=new FormData;o.append("payload",JSON.stringify(s)),i&&o.append("file",i);try{const a=await fetch(this.url,{method:"POST",body:o});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);const l=await a.json();await this.afterFormSubmit(n,l.data,l.message)}catch(a){console.error("Failed to fetch data:",a)}};async function _n(e,t){try{const n=await fetch("/sd_webui_ux/delete_invalid_items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table_name:e.table_name})});if(!n.ok)throw new Error(`DELETE failed! Status: ${n.status}`);const s=await fetch("/sd_webui_ux/import_update_table",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table_name:e.table_name})});if(!s.ok)throw new Error(`IMPORT failed! Status: ${s.status}`);t.showLoadingIndicator();const i=s.body.getReader(),o=new TextDecoder;for(;;){const{done:a,value:l}=await i.read();if(a)break;const u=o.decode(l,{stream:!0}).split(`
`).filter(d=>d.trim());for(const d of u)try{const m=JSON.parse(d);t.updateLoadingIndicator(Math.round(m.progress)),console.log(`Processed ${m.processed}/${m.total} (${m.progress}%)`)}catch(m){console.error("JSON parse error:",m,"Raw:",d)}}return t.hideLoadingIndicator(),e.skip=0,await t.updateParamsAndFetch(e,0),{success:!0,message:"Table resynced successfully"}}catch(n){return console.error("Operation failed:",n),t.hideLoadingIndicator(),{success:!1,error:n.message}}}async function Gi(){Ut("checkpoints","checkpoint","stable-diffusion/")}async function Vi(){Ut("textual_inversion","textualinversion","embeddings/")}async function Xi(){Ut("lora","lora","lora/")}async function Yi(){Ut("hypernetworks","hypernetwork","hypernetworks/")}function Zi(e,t){const n=e.parentElement.querySelector(".ae-virtual-detail-content");n.innerHTML="",n.appendChild(t)}async function Ki(e,t,n,s){const i=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(e)}&name=${encodeURIComponent(t)}`;os(i,function(o){console.log(o),n.showDetail();const a=window.extraNetworksFlattenMetadata(o),l=window.createVisualizationTable(a,0);Zi(s,l)})}const Xe={};async function Ut(e,t,n){const s=document.querySelector(`#${e}_cardholder`),i=document.querySelector(`#${e}_search`);document.querySelector(`#${e}_sort`);const o=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const a=document.querySelector(`#${e}_refresh`),l=document.querySelector(`#${e}_rebuild`),r=document.querySelector(`#${e}_clear`),u=document.querySelector(`#${e}_show-dirs`),d=document.querySelector(`#${e}_search_row`),m=document.querySelector(`#layout_db_${e} > div`);new ResizeObserver(()=>{if(!m||!u)return;const b=m.offsetHeight,S=u.offsetHeight+10;b>S?d.style.order="100":d.style.order=""}).observe(m),Xe[`txt2img_${t}`]=[],Xe[`img2img_${t}`]=[];const E=100,w="/sd_webui_ux/get_items_from_db",q="GET",I={table_name:t,skip:0,limit:E,sort_by:"name",order:"asc",search_term:""},M={title:"name",url:"preview",dataPath:"items"},f={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},y=b=>(b.skip=0,b),h=new Je(s,[],18,M,w,I,q),v=vt(f,I,h,y);h.setNextCursor=function(b){b&&this.data.length>0?this.params.skip=this.params.cursor=b:delete this.params.cursor};let k="thumbnail";h.createItemElement=b=>zi(b,k,h.selected,"/sd_extra_networks/thumb?filename=");function W(b,S,z){var F;const V=window.UIUX.FOCUS_PROMPT;let J=((F=S.prompt)==null?void 0:F.replace("opts.extra_networks_default_multiplier",S.preferred_weight>0?S.preferred_weight:opts.extra_networks_default_multiplier))||"";J+=S.activation_text||"";const se=S.negative_prompt||"";if(b.classList.contains("copy-path"))navigator.clipboard.writeText(S.filename);else if(b.classList.contains("fullsize-button"))h.scrollToId(S.id),h.isFullSize?(k="thumbnail",h.setFullSize(!1),h.setLayout("vertical"),b.classList.remove("active")):(k="local_preview",h.setFullSize(!0),h.setLayout("vertical"),b.classList.add("active"));else if(b.classList.contains("info-button"))h.setInfo(!h.isInfo);else if(b.classList.contains("fullScreen-button"))h.scrollToId(S.id),h.setFullScreen(!h.isFullScreen);else if(b.classList.contains("show-meta"))Ki(S.type,S.name,h,s);else if(b.classList.contains("edit-meta"))R(S,S.id);else if(b.classList.contains("send-params-button")){const ie=`/sd_extra_networks/thumb?filename=${encodeURIComponent(S.preview||S.local_preview)}`;ot(ie,`#pnginfo_send_${V} button`)}else if(S.type==="Checkpoint"){if(h.isFullSize)return;window.selectCheckpoint(S.name)}else if(S.type==="TextualInversion"){if(h.isFullSize)return;window.cardClicked(V,J,se,!0),Xe[`${V}_textualinversion`].push({id:S.id,name:S.name,value:J})}else if(S.type==="LORA"){if(h.isFullSize)return;window.cardClicked(V,J,se,!1),Xe[`${V}_lora`].push({id:S.id,name:S.name,value:`<lora:${J.split(":")[1]}`})}else if(S.type==="Hypernetwork"){if(h.isFullSize)return;window.cardClicked(V,J,se,!1),Xe[`${V}_hypernetwork`].push({id:S.id,name:S.name,value:J})}}h.clickHandler=function(b){if(h.dragged||h.scrollDelta)return;const S=b.target.closest(".item.card"),z=S==null?void 0:S.dataset.id;if(z){const V=this.data.find(J=>J.id.toString()===z);V&&W(b.target,V)}b.stopPropagation()},l.addEventListener("click",b=>{qe("/sd_webui_ux/generate-thumbnails",{table_name:t},function(S){console.log(S),setTimeout(()=>{v.skip=0,h.updateParamsAndFetch(v,0)},1e3)})}),o.addEventListener("click",b=>{const S=o.classList.contains("active");v.skip=0,v.order=S?"desc":"asc",h.updateParamsAndFetch(v,0)}),r.addEventListener("click",b=>{i.value="",He(i)}),h.updateParamsAndFetch(v,0);let ne;t!=="checkpoint"?document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(b=>{b.addEventListener("input",C),b.addEventListener("focus",$)}):ne=fi(h);let H;function A(){H=new we(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n),H.initialize(),ne==null||ne.setTreeViewCallback(b=>{H.selected=b,H.updateSelectedItems()}),H.createFileItem=function(b,S){var F;const z=document.createElement("li");z.dataset.name=b[S].name,z.dataset.id=b[S].id,(F=this.selected)!=null&&F.has(b[S].name)&&z.classList.add("active"),z.innerHTML=`<summary class="tree-file">${b[S].name}</summary>`,z.classList.add("li-file");const V=document.createElement("button");V.className="edit-meta edit-button card-button";const J=document.createElement("button");J.className="copy-path copy-path-button card-button";const se=document.createElement("div");if(se.className="item-actions",se.appendChild(J),b[S].metadata_exists){const ie=document.createElement("button");ie.className="show-meta metadata-button card-button",se.appendChild(ie)}return se.appendChild(V),z.appendChild(se),z},H.onFolderClicked=function(b,S,z){},H.onFileClicked=function(b,S){W(b,S,S.id)}}u.addEventListener("click",()=>{A()},{once:!0}),a.addEventListener("click",async()=>{const b=await _n(v,h);H&&await H.initialize(),b.success||console.warn(`Resync failed: ${b.error}`)});function p(){H&&(H.selected=h.selected,H.updateSelectedItems())}function C(b){const S=window.UIUX.FOCUS_PROMPT,z=Xe[`${S}_${t}`];setTimeout(()=>{let V="";document.querySelectorAll(`#${S}_prompt textarea, #${S}_neg_prompt textarea`).forEach(F=>{V+=F.value});const J=z.filter(F=>F&&F.value&&V.includes(F.value));Xe[`${S}_${t}`]=J;const se=new Set(J.map(F=>F.name));h.selected=se,h.forceRenderItems(),p()},100)}function $(b){const S=window.UIUX.FOCUS_PROMPT;let z="";if(document.querySelectorAll(`#${S}_prompt textarea, #${S}_neg_prompt textarea`).forEach(se=>{z+=` ${se.value}`}),z.length>2){let se=function(U){return U.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var V=se;let ie=z.trim().split(/[\s,.]+/).map(se).filter(Boolean);if(t==="lora"||t==="hypernetwork"){let K=function(ce){if(ce.includes(`${U}:`)){const me=ce.split(`${U}:`)[1].split(":")[0];return`<${U}:${me}:opts.extra_networks_default_multiplier>`}return""};var J=K;const U=t==="lora"?"lora":"hypernet";ie=z.trim().split("<").map(K).filter(Boolean)}ie.length>0&&qe("/sd_webui_ux/search_words_in_tables_columns",{tables:t,columns:"prompt",words:ie},function(j){const me=j[t].map(x=>{let _=x.prompt;return(t==="lora"||t==="hypernetwork")&&(_=`<${t==="lora"?"lora":"hypernet"}:${x.prompt.split(":")[1]}`),{id:x.id,name:x.name,value:_}});Xe[`${S}_${t}`]=me,h.selected=new Set(me.map(x=>x.name)),h.forceRenderItems(),p()})}else h.selected=new Set,h.forceRenderItems(),p()}function R(b,S){const z={local_preview:{type:"input",name:"local_preview"},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:b.sd_version,options:pn},preferred_weight:{type:"number",name:"preferred_weight",label:"Preferred Weight"},activation_text:{type:"textarea",name:"activation_text",label:"Activation Text",rows:4},negative_prompt:{type:"textarea",name:"negative_prompt",label:"Negative Prompt",rows:2},description:{type:"textarea",name:"description",label:"Description",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},notes:{type:"textarea",name:"notes",label:"Notes",rows:2}},V={filename:{type:"filename"},filesize:{type:"filesize"},type:{type:"text"},hash:{type:"text"},date_created:{type:"date-format"},date_modified:{type:"date-format"}},J={thumbnail:{type:"img",api:"/sd_extra_networks/thumb?filename=",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1},browse_preview:{type:"button",label:"Browse Preview",showLabel:!1}},se=`/sd_webui_ux/get_internal_metadata?type=${encodeURIComponent(b.type)}&name=${encodeURIComponent(b.name)}`;os(se,function(F){var ee;const ie=F,U="/sd_webui_ux/update_user_metadata",K=document.getElementById("formContainer"),j=new _e(U,t,b,K),ce=j.createForm(z),me=j.createTable(V),x=j.createHtmlElement(J),_=j.createTagsElement(ie,"Train Tags");if(_){(ee=ce.children[2])==null||ee.insertAdjacentElement("afterend",_);let P=ce.querySelector("#activation_text");ce.addEventListener("click",B=>{const te=B.target.closest("textarea");te&&(P=te);const ae=B.target.closest("button[type=button]");if(ae){const ye=ae.childNodes[0].textContent.trim(),De=P.value;De.includes(ye)?P.value=De.split(",").map(Qe=>Qe.trim()).filter(Qe=>Qe!==ye).join(", "):P.value+=(De?", ":"")+ye}})}const T=document.createElement("div");T.classList.add("non-editable-info","flexbox","padding","shrink"),T.appendChild(x),T.appendChild(me),h.showDetail();const N=s.parentElement.querySelector(".ae-virtual-detail-content");N.innerHTML="",N.appendChild(T),N.appendChild(ce);function Z(P){const B=P.lastIndexOf(".");return B===-1?P:P.substring(0,B)}function oe(P){const B=P.lastIndexOf("/"),te=P.substring(0,B),ae=P.substring(B+1),ye=ae.lastIndexOf("."),De=ae.substring(0,ye);return{path:te,filename:ae,filename_no_ext:De}}let Q,le;j.beforeFormSubmit=function(P){return P.id=b.id,P.type=b.type,P.name=b.name,P.prompt=b.prompt,P.filename=b.filename,Q&&(P.source_file=Q),le&&(P.file=le),console.log(P),P};let he=b.local_preview;j.afterFormSubmit=function(P){h.hideDetail();const B=oe(he),te=new Date().getTime();P.thumbnail=`${B.path}/thumbnails/${B.filename_no_ext}.thumb.webp`,P.timestamp=`&t=${te}`,h.updateDataById(P,S),H==null||H.update()};const pe=x.querySelector("button.replace_preview"),Ce=x.querySelector(".thumbnail-image");pe.addEventListener("click",P=>{const B=window.UIUX.FOCUS_PROMPT,te=document.querySelector(`#${B}_gallery [data-testid="detailed-image"]`);te&&(Q=te.src.split("file=")[1].split("?")[0],Ce.style.filter="grayscale(1)")});const be=document.createElement("input");be.type="file",be.accept="image/jpeg, image/png, image/webp, image/gif",be.addEventListener("change",P=>{const B=P.target.files[0];B&&(le=B,Ce.style.filter="grayscale(1)")}),x.querySelector("button.browse_preview").addEventListener("click",P=>{be.click()})})}}async function Ji(){Qi("styles","styles","styles_data/")}const nt={};let G,de,Ue,an;async function Qi(e,t,n){an=document.querySelector(`#${e}_cardholder`);const s=document.querySelector(`#${e}_search`);document.querySelector(`#${e}_sort`);const i=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const o=document.querySelector(`#${e}_refresh`),a=document.querySelector(`#${e}_rebuild`),l=document.querySelector(`#${e}_clear`),r=document.querySelector(`#${e}_show-dirs`);nt[`txt2img_${t}`]=[],nt[`img2img_${t}`]=[];const u=100,d="/sd_webui_ux/get_items_from_db",m="GET",g={table_name:t,skip:0,limit:u,sort_by:"name",order:"asc",search_term:""},E={title:"name",url:"preview",dataPath:"items"},w={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},q=A=>(A.skip=0,A);G=new Je(an,[],18,E,d,g,m),Ue=vt(w,g,G,q),G.setNextCursor=function(A){A&&this.data.length>0?this.params.skip=this.params.cursor=A:delete this.params.cursor};let I="thumbnail";G.createItemElement=A=>ps(A,I,G.selected,"/sd_styles/thumb/"),G.clickHandler=function(A){if(G.dragged||G.scrollDelta)return;const p=A.target.closest(".item.card"),C=p==null?void 0:p.dataset.id;if(C){const $=this.data.find(R=>R.id.toString()===C);$&&v(A.target,$)}A.preventDefault(),A.stopPropagation()},a.addEventListener("click",A=>{qe("/sd_webui_ux/generate-thumbnails",{table_name:t},function(p){setTimeout(()=>{Ue.skip=0,G.updateParamsAndFetch(Ue,0)},1e3)})}),i.addEventListener("click",A=>{const p=i.classList.contains("active");Ue.skip=0,Ue.order=p?"desc":"asc",G.updateParamsAndFetch(Ue,0)}),l.addEventListener("click",A=>{s.value="",He(s)}),G.updateParamsAndFetch(Ue,0);function M(){de||(de=new we(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n),de.initialize(),de.createFileItem=function(A,p){var S;const C=document.createElement("li");C.dataset.name=A[p].name,C.dataset.id=A[p].id,(S=this.selected)!=null&&S.has(A[p].name)&&C.classList.add("active"),C.innerHTML=`<summary class="tree-file">${A[p].name}</summary>`,C.classList.add("li-file");const $=document.createElement("button");$.className="edit-meta edit-button card-button";const R=document.createElement("button");R.className="copy-path copy-path-button card-button";const b=document.createElement("div");return b.className="item-actions",b.appendChild(R),b.appendChild($),C.appendChild(b),C},de.onFolderClicked=function(A,p,C){},de.onFileClicked=function(A,p){v(A,p,p.id)})}r.addEventListener("click",()=>{M()});function f(){de&&(de.selected=G.selected,de.updateSelectedItems())}o.addEventListener("click",async()=>{const A=await _n(Ue,G);de&&await de.initialize(),A.success||console.warn(`Resync failed: ${A.error}`)});function y(A){const p=window.UIUX.FOCUS_PROMPT,C=nt[`${p}_${t}`];setTimeout(()=>{let $="";document.querySelectorAll(`#${p}_prompt textarea, #${p}_neg_prompt textarea`).forEach(S=>{$+=S.value});const R=C.filter(S=>S&&S.value&&$.includes(S.value));nt[`${p}_${t}`]=R;const b=new Set(R.map(S=>S.name));G.selected=b,G.forceRenderItems(),f()},100)}function h(A){const p=window.UIUX.FOCUS_PROMPT;let C="";if(document.querySelectorAll(`#${p}_prompt textarea`).forEach(R=>{C+=`${R.value}`}),C.length>2){let R=function(V){return V.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var $=R;const z=C.trim().split(". ").map(R).filter(Boolean).map(V=>". "+V);z.length>0&&qe("/sd_webui_ux/search_words_in_tables_columns",{words:z,tables:t,columns:"prompt",threshold:1},function(se){const F=se[t];console.log(F);const ie=F.map(U=>({id:U.id,name:U.name,value:U.prompt}));nt[`${p}_${t}`]=ie,G.selected=new Set(ie.map(U=>U.name)),f()})}else G.selected=new Set,f();G.forceRenderItems(),f()}document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(A=>{A.addEventListener("input",y),A.addEventListener("focus",h)});function v(A,p,C){const $=window.UIUX.FOCUS_PROMPT,R=p.prompt||"",b=p.negative||"";if(A.classList.contains("copy-path"))navigator.clipboard.writeText(p.filename);else if(A.classList.contains("fullsize-button"))G.scrollToId(p.id),G.isFullSize?(I="thumbnail",G.setFullSize(!1),G.setLayout("vertical"),A.classList.remove("active")):(I="local_preview",G.setFullSize(!0),G.setLayout("vertical"),A.classList.add("active"));else if(A.classList.contains("tile-button"))G.setTileable(!G.isTileable);else if(A.classList.contains("info-button"))G.setInfo(!G.isInfo);else if(A.classList.contains("fullScreen-button"))G.scrollToId(p.id),G.setFullScreen(!G.isFullScreen);else if(A.classList.contains("edit-meta"))W(p,p.id);else if(A.classList.contains("delete-button"))k(p,p.id);else if(A.classList.contains("send-params-button")){const S=`/sd_styles/thumb/${encodeURIComponent(p.local_preview)}`;ot(S,`#pnginfo_send_${$} button`)}else if(p.type==="Style"){if(G.isFullSize)return;window.cardClicked($,R,b,!0),nt[`${$}_styles`].push({id:p.id,name:p.name,value:R})}}function k(A,p){const C="/sd_webui_ux/delete_item",$={table_name:t,item_id:A.id};qe(C,$,function(R){G.removeDataById(A.id),de==null||de.update()})}function W(A,p){if(M(),!de.subpaths){setTimeout(()=>{W(A)},1e3);return}const C="styles",$=de.subpaths,R=new Set($.map(ee=>ee.relativePath)),b=Array.from(R);let S=[{value:"None",textContent:"None"}],z;b.forEach(ee=>{var P;(P=A.filename)!=null&&P.includes(`${ee}/`)&&(z=ee),S.push({value:ee,textContent:ee})});const V={local_preview:{type:"input",id:"local_preview_path",name:"local_preview",label:"Local Preview"},row:{type:"row",draw:"true",id:"parent_folder_select_row",label:"Parent Category / Filename",children:[{parent_folder:{type:"select",id:"parent_folder_select",class:"grow",value:z,options:S}},{save_path:{type:"input",id:"parent_folder_save",class:"grow",value:A.name,label:"Style Name"}}]},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:A.sd_version,options:pn},prompt:{type:"textarea",name:"prompt",label:"Prompt",rows:4},negative:{type:"textarea",name:"negative",label:"Negative Prompt",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},description:{type:"textarea",name:"description",label:"Description",rows:2}},J={filename:{type:"filename",label:"Filename"},filesize:{type:"filesize",label:"Filesize"},type:{type:"text",label:"Type"},hash:{type:"text",label:"Hash"},date_created:{type:"date-format",label:"Date Created"},date_modified:{type:"date-format",label:"Date Modified"}},se={thumbnail:{type:"img",api:"/sd_styles/thumb/",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},F="/sd_webui_ux/update_user_metadata",ie=document.getElementById("formContainer"),U=new _e(F,C,A,ie),K=U.createForm(V),j=U.createTable(J),ce=U.createHtmlElement(se),me=document.createElement("div");me.classList.add("non-editable-info","flexbox","padding","shrink"),me.appendChild(ce),me.appendChild(j),G.showDetail();const x=an.parentElement.querySelector(".ae-virtual-detail-content");x.innerHTML="",x.appendChild(me),x.appendChild(K);const _=K.querySelector("#parent_folder_select"),T=K.querySelector("#parent_folder_select_row label"),N=K.querySelector("#parent_folder_save"),Z=K.querySelector("#local_preview_path input"),oe=K.querySelector("button.delete");let Q;const le=ee=>ee.replace(/\/{2,}/g,"/"),he=ee=>{const P=_.value!=="None"?_.value:"",B=N.value,te=`${P}/${B}`;T.textContent=`Style will be saved: ${le(te)}.png`,Q=le(`${$[0].basePath}/${te}.png`),Z.value=Q};_.addEventListener("change",he),N.addEventListener("input",he),he();function pe(ee){const P=ee.lastIndexOf("/"),B=ee.substring(0,P),te=ee.substring(P+1),ae=te.lastIndexOf("."),ye=te.substring(0,ae);return{path:B,filename:te,filename_no_ext:ye}}let Ce;U.beforeFormSubmit=function(ee){return ee.name=pe(Q).filename_no_ext,ee.filename=Q,ee.type="Style",A.id&&(ee.id=A.id),Ce&&(ee.source_file=Ce),ee},U.afterFormSubmit=function(ee,P){G.hideDetail(),G.updateDataById(P,P.id),de==null||de.update()};function be(){const ee=window.UIUX.FOCUS_PROMPT,P=document.querySelector(`#${ee}_gallery [data-testid="detailed-image"]`);if(P){const B=ce.querySelector(".thumbnail-image");Ce=P.src.split("file=")[1].split("?")[0],B.style.filter="grayscale(1)"}}ce.querySelector("button.replace_preview").addEventListener("click",ee=>{be()}),A.id||be(),A.id&&oe.addEventListener("click",ee=>{const P="/sd_webui_ux/delete_item",B={table_name:C,item_id:A.id};qe(P,B,function(te){console.log(te),G.hideDetail(),Ue.skip=0,G.updateParamsAndFetch(Ue,0),de==null||de.update()})})}function ne(){const A=window.UIUX.FOCUS_PROMPT,p=document.querySelector(`#${A}_prompt textarea`),C=document.querySelector(`#${A}_neg_prompt textarea`),$=b=>b.replace(/\s{2,}/g," ").replace(/(\. )\1+/g,". "),R={};R.prompt=$(". "+p.value),R.negative=$(". "+C.value),R.name="Untitled",R.description="",R.tags="",R.local_preview="",W(R)}document.querySelector("#layout_db_styles button.create-style").addEventListener("click",A=>{ne()})}async function eo(){to("output_images","images","outputs/")}const st={};let Y,ue,Ge,rn;async function to(e,t,n){rn=document.querySelector(`#${e}_cardholder`);const s=document.querySelector(`#${e}_search`),i=document.querySelector(`#${e}_sort`);i.value="date_created";const o=document.querySelector(`#${e}_order`);document.querySelector(`#${e}_sd_version`);const a=document.querySelector(`#${e}_refresh`),l=document.querySelector(`#${e}_rebuild`),r=document.querySelector(`#${e}_clear`),u=document.querySelector(`#${e}_show-dirs`);document.querySelector("#refresh_output_images_database"),st[`txt2img_${t}`]=[],st[`img2img_${t}`]=[];const d=100,m="/sd_webui_ux/get_items_from_db",g="GET",E={table_name:t,skip:0,limit:d,sort_by:"date_created",order:"desc",search_term:""},w={title:"name",url:"preview",dataPath:"items"},q={[`#${e}_search`]:"search_term",[`#${e}_sort`]:"sort_by",[`#${e}_search_in`]:"search_columns",[`#${e}_sd_version`]:"sd_version"},I=p=>(p.skip=0,p);Y=new Je(rn,[],18,w,m,E,g),Ge=vt(q,E,Y,I),Y.setNextCursor=function(p){p&&this.data.length>0?this.params.skip=this.params.cursor=p:delete this.params.cursor};let M="thumbnail";Y.createItemElement=p=>ps(p,M,Y.selected,"/sd_image/thumb/"),Y.clickHandler=function(p){if(Y.dragged||Y.scrollDelta)return;const C=p.target.closest(".item.card"),$=C==null?void 0:C.dataset.id;if($){const R=this.data.find(b=>b.id.toString()===$);R&&k(p.target,R)}p.preventDefault(),p.stopPropagation()},l.addEventListener("click",p=>{qe("/sd_webui_ux/generate-thumbnails",{table_name:t},function(C){setTimeout(()=>{Ge.skip=0,Y.updateParamsAndFetch(Ge,0)},1e3)})}),o.addEventListener("click",p=>{const C=o.classList.contains("active");Ge.skip=0,Ge.order=C?"desc":"asc",Y.updateParamsAndFetch(Ge,0)}),r.addEventListener("click",p=>{s.value="",He(s)}),o.click();function f(){ue||(ue=new we(`#${e}_tree_view`,"/sd_webui_ux/get_items_by_path",t,n),ue.initialize(),ue.createFileItem=function(p,C){var z;const $=document.createElement("li");$.dataset.name=p[C].name,$.dataset.id=p[C].id,(z=this.selected)!=null&&z.has(p[C].name)&&$.classList.add("active"),$.innerHTML=`<summary class="tree-file">${p[C].name}</summary>`,$.classList.add("li-file");const R=document.createElement("button");R.className="edit-meta edit-button card-button";const b=document.createElement("button");b.className="copy-path copy-path-button card-button";const S=document.createElement("div");return S.className="item-actions",S.appendChild(b),S.appendChild(R),$.appendChild(S),$},ue.onFolderClicked=function(p,C,$){},ue.onFileClicked=function(p,C){k(p,C,C.id)})}u.addEventListener("click",()=>{f()});function y(){ue&&(ue.selected=Y.selected,ue.updateSelectedItems())}a.addEventListener("click",async()=>{const p=await _n(Ge,Y);ue&&await ue.initialize(),p.success||console.warn(`Resync failed: ${p.error}`)});function h(p){const C=window.UIUX.FOCUS_PROMPT,$=st[`${C}_${t}`];setTimeout(()=>{let R="";document.querySelectorAll(`#${C}_prompt textarea, #${C}_neg_prompt textarea`).forEach(z=>{R+=z.value});const b=$.filter(z=>z&&z.value&&R.includes(z.value));st[`${C}_${t}`]=b;const S=new Set(b.map(z=>z.name));Y.selected=S,Y.forceRenderItems(),y()},100)}function v(p){const C=window.UIUX.FOCUS_PROMPT;let $="";if(document.querySelectorAll(`#${C}_prompt textarea`).forEach(b=>{$+=`${b.value}`}),$.length>2){let b=function(J){return J.replace(/[()]+|:[0-9]+(.[0-9]+)?/g,"").trim()};var R=b;const V=$.trim().split(". ").map(b).filter(Boolean).map(J=>". "+J);V.length>0&&qe("/sd_webui_ux/search_words_in_tables_columns",{words:V,tables:t,columns:"prompt",threshold:1},function(F){const ie=F[t];console.log(ie);const U=ie.map(K=>({id:K.id,name:K.name,value:K.prompt}));st[`${C}_${t}`]=U,Y.selected=new Set(U.map(K=>K.name))})}else Y.selected=new Set;Y.forceRenderItems(),y()}document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(p=>{p.addEventListener("input",h),p.addEventListener("focus",v)});function k(p,C,$){const R=window.UIUX.FOCUS_PROMPT,b=C.prompt||"",S=C.negative||"";if(p.classList.contains("copy-path"))navigator.clipboard.writeText(C.filename);else if(p.classList.contains("fullsize-button"))Y.scrollToId(C.id),Y.isFullSize?(M="thumbnail",Y.setFullSize(!1),Y.setLayout("vertical"),p.classList.remove("active")):(M="local_preview",Y.setFullSize(!0),Y.setLayout("vertical"),p.classList.add("active"));else if(p.classList.contains("tile-button"))Y.setTileable(!Y.isTileable);else if(p.classList.contains("info-button"))Y.setInfo(!Y.isInfo);else if(p.classList.contains("fullScreen-button"))Y.scrollToId(C.id),Y.setFullScreen(!Y.isFullScreen);else if(p.classList.contains("edit-meta"))ne(C,C.id);else if(p.classList.contains("delete-button"))W(C,C.id);else if(p.classList.contains("send-params-button")){const z=`/sd_image/thumb/${encodeURIComponent(C.local_preview)}`;ot(z,`#pnginfo_send_${R} button`)}else if(C.type==="Image"){if(Y.isFullSize)return;window.cardClicked(R,b,S,!0),st[`${R}_${t}`].push({id:C.id,name:C.name,value:b})}}function W(p,C){qe("/sd_webui_ux/delete_item",{table_name:t,item_id:C},function(b){Y.removeDataById(C),ue==null||ue.update()})}function ne(p,C){if(f(),!ue.subpaths){setTimeout(()=>{ne(p)},1e3);return}const $="images",R=ue.subpaths,b=new Set(R.map(P=>P.relativePath)),S=Array.from(b);let z=[{value:"None",textContent:"None"}],V;S.forEach(P=>{var B;(B=p.filename)!=null&&B.includes(`${P}/`)&&(V=P),z.push({value:P,textContent:P})});const J={local_preview:{type:"input",id:"local_preview_path",name:"local_preview",label:"Local Preview"},row:{type:"row",draw:"true",id:"parent_folder_select_row",label:"Parent Category / Filename",children:[{parent_folder:{type:"select",id:"parent_folder_select",class:"grow",value:V,options:z}},{save_path:{type:"input",id:"parent_folder_save",class:"grow",value:p.name,label:"Image Name"}}]},sd_version:{type:"select",name:"sd_version",label:"SD Version",value:p.sd_version,options:pn},prompt:{type:"textarea",name:"prompt",label:"Prompt",rows:4},negative:{type:"textarea",name:"negative",label:"Negative Prompt",rows:2},tags:{type:"textarea",name:"tags",label:"Tags"},description:{type:"textarea",name:"description",label:"Description",rows:2}},se={filename:{type:"filename",label:"Filename"},filesize:{type:"filesize",label:"Filesize"},type:{type:"text",label:"Type"},hash:{type:"text",label:"Hash"},date_created:{type:"date-format",label:"Date Created"},date_modified:{type:"date-format",label:"Date Modified"}},F={thumbnail:{type:"img",api:"/sd_image/thumb/",showLabel:!1},replace_preview:{type:"button",label:"Replace Preview",showLabel:!1}},ie="/sd_webui_ux/update_user_metadata",U=document.getElementById("formContainer"),K=new _e(ie,$,p,U),j=K.createForm(J),ce=K.createTable(se),me=K.createHtmlElement(F),x=document.createElement("div");x.classList.add("non-editable-info","flexbox","padding","shrink"),x.appendChild(me),x.appendChild(ce),Y.showDetail();const _=rn.parentElement.querySelector(".ae-virtual-detail-content");_.innerHTML="",_.appendChild(x),_.appendChild(j);const T=j.querySelector("#parent_folder_select"),N=j.querySelector("#parent_folder_select_row label"),Z=j.querySelector("#parent_folder_save"),oe=j.querySelector("#local_preview_path input"),Q=j.querySelector("button.delete");let le;const he=P=>P.replace(/\/{2,}/g,"/"),pe=P=>{const B=T.value!=="None"?T.value:"",te=Z.value,ae=`${B}/${te}`;N.textContent=`Image will be saved: ${he(ae)}.png`,le=he(`${R[0].basePath}/${ae}.png`),oe.value=le};T.addEventListener("change",pe),Z.addEventListener("input",pe),pe();function Ce(P){const B=P.lastIndexOf("/"),te=P.substring(0,B),ae=P.substring(B+1),ye=ae.lastIndexOf("."),De=ae.substring(0,ye);return{path:te,filename:ae,filename_no_ext:De}}let be;K.beforeFormSubmit=function(P){return P.name=Ce(le).filename_no_ext,P.filename=le,P.type="Image",p.id&&(P.id=p.id),be&&(P.source_file=be),P},K.afterFormSubmit=function(P,B){Y.hideDetail(),Y.updateDataById(B,B.id),ue==null||ue.update()};function Ze(){const P=window.UIUX.FOCUS_PROMPT,B=document.querySelector(`#${P}_gallery [data-testid="detailed-image"]`);if(B){const te=me.querySelector(".thumbnail-image");be=B.src.split("file=")[1].split("?")[0],te.style.filter="grayscale(1)"}}me.querySelector("button.replace_preview").addEventListener("click",P=>{Ze()}),p.id||Ze(),p.id&&Q.addEventListener("click",P=>{const B="/sd_webui_ux/delete_item",te={table_name:$,item_id:p.id};qe(B,te,function(ae){console.log(ae),Y.hideDetail(),Ge.skip=0,Y.updateParamsAndFetch(Ge,0),ue==null||ue.update()})})}function H(){const p=window.UIUX.FOCUS_PROMPT,C=document.querySelector(`#${p}_prompt textarea`),$=document.querySelector(`#${p}_neg_prompt textarea`),R=S=>S.replace(/\s{2,}/g," ").replace(/(\. )\1+/g,". "),b={};b.prompt=R(". "+C.value),b.negative=R(". "+$.value),b.name="Untitled",b.description="",b.tags="",b.local_preview="",ne(b)}document.querySelector("#layout_db_output_images button.create-style").addEventListener("click",p=>{H()})}function no(e){const t=document.querySelector("#logger_screen");t&&(document.querySelector("#container-console-log").append(getLoggerUiUx()),t.remove()),console.log("Finishing optimizations for Extra Networks"),pi(),mi(),ri(),di(),ui(),document.querySelectorAll("#txt2img_styles_edit_button, #img2img_styles_edit_button").forEach(a=>{a.addEventListener("click",function(l){window.popup_trigger.click()})});function n(a){Mn.FOCUS_PROMPT=a.includes("txt2img")?"txt2img":"img2img"}if(document.querySelectorAll("#txt2img_prompt textarea, #img2img_prompt textarea, #txt2img_neg_prompt textarea, #img2img_neg_prompt textarea").forEach(a=>{a.addEventListener("focus",l=>{const r=l.target.closest(".gradio-textbox").id;n(r)})}),document.querySelectorAll("#about_tabitem img").forEach(a=>{const l=a.getAttribute("data-src");l&&(a.src=l.replace("file=extensions/sd-webui-ux/assets/",`${Ft}`))}),window.UIUX=Mn,Rt.setItem("UiUxComplete","true"),window.opts.uiux_enable_theme_editor&&bi(),window.opts.uiux_enable_civitai_explorer){document.querySelector("#civitai_explorer_nav").classList.remove("hidden");const l=document.querySelector("#civitai_nav_images"),r=document.querySelector("#civitai_nav_models");l.addEventListener("click",()=>{ji()},{once:!0}),r.addEventListener("click",()=>{Wi()},{once:!0})}const s=document.querySelector("#textual_inversion_nav"),i=document.querySelector("#lora_nav"),o=document.querySelector("#hypernetwork_nav");if(setTimeout(()=>{Gi()},500),s.addEventListener("click",()=>{Vi()},{once:!0}),i.addEventListener("click",()=>{Xi()},{once:!0}),o.addEventListener("click",()=>{Yi()},{once:!0}),window.opts.uiux_enable_sd_styles){const a=document.querySelector("#sd_styles_nav");a.classList.remove("hidden"),a.addEventListener("click",()=>{Ji()},{once:!0})}if(window.opts.uiux_enable_sd_output_images){const a=document.querySelector("#sd_output_images_nav");a.classList.remove("hidden"),a.addEventListener("click",()=>{eo()},{once:!0})}qs(".layout-extra-networks"),zt||(document.querySelector("#github-project-link").href="https://github.com/anapnoe/sd-webui-ux"),hi()}async function so(){const e=at(),t=Ye();await Es(),t.insertAdjacentElement("afterbegin",e);const n=Zs((s,i)=>{s==="UiUxReady"&&i==="true"&&(no(),n())},"UiUxReady");(async()=>await ss(e))(),Fs(),setTimeout(()=>{xs("#infinite_image_browsing_container_wrapper iframe",["user.css","uiux-iibrowser.css"])},3e3)}async function io(){try{Os(),console.log("Starting DOM Optimizations"),oi(),ii(),console.log("Finishing DOM Optimizations"),Ts(Ns),Ve.gradio_major>3&&Ls("style.css","style-gradio-4.css",document.body),(async()=>(await Ds(),await so()))()}catch(e){console.error("Error in run sequence:",e)}}function oo(){if(localStorage.setItem("UiUxReady","false"),localStorage.setItem("UiUxComplete","false"),!document.getElementById("logger_screen")){const n=document.createElement("div");n.id="logger_screen",n.style="position: fixed; inset: 0; background-color: black; z-index: 99999; display: flex; flex-direction: column; overflow:auto;";const s=document.createElement("div");s.id="loggerUiUx",n.append(s),document.body.append(n)}const e=new MutationObserver(async()=>{if(Qn()&&window.opts&&Object.keys(window.opts).length){e.disconnect();try{await io()}catch(s){console.error("Error running the function:",s)}}}),t=Ye();t?e.observe(t,{childList:!0,subtree:!0}):console.error("getGradioApp() did not return a valid target for observation")}oo();
